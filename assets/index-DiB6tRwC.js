var oo=Object.defineProperty;var so=(e,t,n)=>t in e?oo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Tt=(e,t,n)=>(so(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();function E(){}function Qn(e){return e()}function Un(){return Object.create(null)}function _e(e){e.forEach(Qn)}function xn(e){return typeof e=="function"}function it(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let xe;function K(e,t){return e===t?!0:(xe||(xe=document.createElement("a")),xe.href=t,e===xe.href)}function io(e){return Object.keys(e).length===0}function co(e,...t){if(e==null){for(const o of t)o(void 0);return E}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function nt(e,t,n){e.$$.on_destroy.push(co(t,n))}function zn(e){return e??""}function s(e,t){e.appendChild(t)}function O(e,t,n){e.insertBefore(t,n||null)}function D(e){e.parentNode&&e.parentNode.removeChild(e)}function eo(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function u(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function w(){return h(" ")}function ao(){return h("")}function J(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function f(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function lo(e){return e===""?null:+e}function ro(e){return Array.from(e.childNodes)}function A(e,t){t=""+t,e.data!==t&&(e.data=t)}function $e(e,t){e.value=t??""}function Hn(e,t,n){for(let o=0;o<e.options.length;o+=1){const i=e.options[o];if(i.__value===t){i.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function uo(e){const t=e.querySelector(":checked");return t&&t.__value}let Ie;function Se(e){Ie=e}function fo(){if(!Ie)throw new Error("Function called outside component initialization");return Ie}function po(e){fo().$$.on_mount.push(e)}const ge=[],Nt=[];let ve=[];const Jn=[],mo=Promise.resolve();let kt=!1;function go(){kt||(kt=!0,mo.then(to))}function ot(e){ve.push(e)}const qt=new Set;let fe=0;function to(){if(fe!==0)return;const e=Ie;do{try{for(;fe<ge.length;){const t=ge[fe];fe++,Se(t),vo(t.$$)}}catch(t){throw ge.length=0,fe=0,t}for(Se(null),ge.length=0,fe=0;Nt.length;)Nt.pop()();for(let t=0;t<ve.length;t+=1){const n=ve[t];qt.has(n)||(qt.add(n),n())}ve.length=0}while(ge.length);for(;Jn.length;)Jn.pop()();kt=!1,qt.clear(),Se(e)}function vo(e){if(e.fragment!==null){e.update(),_e(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ot)}}function ho(e){const t=[],n=[];ve.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),ve=t}const et=new Set;let ne;function _o(){ne={r:0,c:[],p:ne}}function bo(){ne.r||_e(ne.c),ne=ne.p}function Fe(e,t){e&&e.i&&(et.delete(e),e.i(t))}function tt(e,t,n,o){if(e&&e.o){if(et.has(e))return;et.add(e),ne.c.push(()=>{et.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function st(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function no(e){e&&e.c()}function Et(e,t,n){const{fragment:o,after_update:i}=e.$$;o&&o.m(t,n),ot(()=>{const c=e.$$.on_mount.map(Qn).filter(xn);e.$$.on_destroy?e.$$.on_destroy.push(...c):_e(c),e.$$.on_mount=[]}),i.forEach(ot)}function Lt(e,t){const n=e.$$;n.fragment!==null&&(ho(n.after_update),_e(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function wo(e,t){e.$$.dirty[0]===-1&&(ge.push(e),go(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Bt(e,t,n,o,i,c,a=null,d=[-1]){const m=Ie;Se(e);const l=e.$$={fragment:null,ctx:[],props:c,update:E,not_equal:i,bound:Un(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(m?m.$$.context:[])),callbacks:Un(),dirty:d,skip_bound:!1,root:t.target||m.$$.root};a&&a(l.root);let $=!1;if(l.ctx=n?n(e,t.props||{},(p,_,...C)=>{const F=C.length?C[0]:_;return l.ctx&&i(l.ctx[p],l.ctx[p]=F)&&(!l.skip_bound&&l.bound[p]&&l.bound[p](F),$&&wo(e,p)),_}):[],l.update(),$=!0,_e(l.before_update),l.fragment=o?o(l.ctx):!1,t.target){if(t.hydrate){const p=ro(t.target);l.fragment&&l.fragment.l(p),p.forEach(D)}else l.fragment&&l.fragment.c();t.intro&&Fe(e.$$.fragment),Et(e,t.target,t.anchor),to()}Se(m)}class jt{constructor(){Tt(this,"$$");Tt(this,"$$set")}$destroy(){Lt(this,1),this.$destroy=E}$on(t,n){if(!xn(n))return E;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const i=o.indexOf(n);i!==-1&&o.splice(i,1)}}$set(t){this.$$set&&!io(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const yo="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yo);const pe=[];function ct(e,t=E){let n;const o=new Set;function i(d){if(it(e,d)&&(e=d,n)){const m=!pe.length;for(const l of o)l[1](),pe.push(l,e);if(m){for(let l=0;l<pe.length;l+=2)pe[l][0](pe[l+1]);pe.length=0}}}function c(d){i(d(e))}function a(d,m=E){const l=[d,m];return o.add(l),o.size===1&&(n=t(i,c)||E),d(e),()=>{o.delete(l),o.size===0&&n&&(n(),n=null)}}return{set:i,update:c,subscribe:a}}let Rn=0;const Co=3e3;function $o(){const{subscribe:e,update:t}=ct([]);function n(i){Rn+=1;const c=Rn,a={...i,id:c};t(d=>[...d,a].slice(-5)),setTimeout(()=>{o(c)},Co)}function o(i){t(c=>c.filter(a=>a.id!==i))}return{subscribe:e,addNotification:n,closeNotification:o}}const he=$o();function Vn(e,t,n){const o=e.slice();return o[2]=t[n],o}function Zn(e){let t,n,o=e[2].text+"",i,c,a,d,m,l,$;function p(){return e[1](e[2])}return{c(){t=u("div"),n=u("div"),i=h(o),c=w(),a=u("button"),a.textContent="X",d=w(),f(a,"class","svelte-1mipv5u"),f(t,"class",m=zn(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(_,C){O(_,t,C),s(t,n),s(n,i),s(t,c),s(t,a),s(t,d),l||($=J(a,"click",p),l=!0)},p(_,C){e=_,C&1&&o!==(o=e[2].text+"")&&A(i,o),C&1&&m!==(m=zn(`notification ${e[2].type}`)+" svelte-1mipv5u")&&f(t,"class",m)},d(_){_&&D(t),l=!1,$()}}}function So(e){let t,n=st(e[0]),o=[];for(let i=0;i<n.length;i+=1)o[i]=Zn(Vn(e,n,i));return{c(){t=u("div");for(let i=0;i<o.length;i+=1)o[i].c();f(t,"id","notifications-container"),f(t,"class","svelte-1mipv5u")},m(i,c){O(i,t,c);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(t,null)},p(i,[c]){if(c&1){n=st(i[0]);let a;for(a=0;a<n.length;a+=1){const d=Vn(i,n,a);o[a]?o[a].p(d,c):(o[a]=Zn(d),o[a].c(),o[a].m(t,null))}for(;a<o.length;a+=1)o[a].d(1);o.length=n.length}},i:E,o:E,d(i){i&&D(t),eo(o,i)}}}function Fo(e,t,n){let o;return nt(e,he,c=>n(0,o=c)),[o,c=>he.closeNotification(c.id)]}class Io extends jt{constructor(t){super(),Bt(this,t,Fo,So,it,{})}}const Do="https://yup.perfdive.com/api",at=async(e,t)=>{const n=await fetch(`${Do}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},Mo=async e=>{try{return await at("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),he.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},To=async e=>{try{return await at("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),he.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},Pt=async(e,t)=>{try{return await at("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:e},body:JSON.stringify(t)})}catch(n){console.error(n),he.addNotification({text:`Send ${e} event failed, `+n.message,type:"error"})}},qo=async e=>{const t=new FormData;t.append("photo",e);try{const n=await at("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),he.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},Ao=e=>{const t=e.getCapabilities(),n=e.getSettings();return Mo(t),To(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:p}=t;return p&&(p.max-p.min)/p.step,p},getSettings:()=>e.getSettings(),setFocusMode:p=>e.applyConstraints({advanced:[{focusMode:p}]}),setFocusDistance:p=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:p}]}),setTorch:p=>{t.torch&&e.applyConstraints({advanced:[{torch:p}]})},settings:n,setFocusDistancePct:async p=>{const{focusDistance:_}=t;if(!_){alert("Focus distance not supported");return}const C=(_.max-_.min)/100,F=_.min+C*p;try{await e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:F}]})}catch(g){alert(g.message),console.error(g)}return F},setZoom:p=>e.applyConstraints({advanced:[{zoom:p}]})}},Oo=.1;let me;const No=({file:e,volume:t})=>{me==null||me.pause(),me=new Audio(`public/sounds/${e}.ogg`),me.volume=t||Oo,me.play()};function ko(){const e=["grabFrame","videoCapture"];let t="videoCapture",n=0,o=0,i=0,c=0,a=0,d,m=!1,l=null,$,p,_;function C(b,y,T,R){_=b,$=new ImageCapture(y),p=new BarcodeDetector({formats:["pdf417"]})}async function F(){if(t==="grabFrame")return $.grabFrame();if(t==="videoCapture")return _;if(t==="takePhoto"){const b=await $.takePhoto(),y=new Image;return y.src=URL.createObjectURL(b),await new Promise(T=>{y.onload=T}),y}}async function g(){const b=await F();return await p.detect(b)}async function M(){try{const b=await $.grabFrame(),y=document.createElement("canvas"),T=y.getContext("2d");y.width=b.width,y.height=b.height,T.drawImage(b,0,0),y.toBlob(R=>{qo(R)})}catch(b){console.log(b)}}function I(b){const y=Date.now()-b;c+=1,a=c>1?(a*(c-1)+y)/c:y,N(T=>({...T,scanCount:c,average:a}))}async function G(){try{const b=Date.now(),y=await g();if(m)return;I(b),y.length>0?(Pt("barcode",y[0]),n+=1,l=y[0].rawValue,N(T=>({...T,barcode:l,success:n})),No({file:"Ceres",volume:1})):(o+=1,N(T=>({...T,fail:o})))}catch(b){i+=1,N(y=>({...y,error:i})),console.log(b)}finally{setTimeout(G,100)}}function j(){m=!0,clearInterval(d)}const{subscribe:U,update:N}=ct({mode:t,success:n,fail:o,barcode:l,scanCount:c,error:i,average:a,toggleMode:()=>{const y=(e.indexOf(t)+1)%e.length;t=e[y],N(T=>({...T,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{l=null}});return{init:C,subscribe:U,toggleMode:()=>N(b=>({...b,mode:e[(e.indexOf(b.mode)+1)%e.length]})),resetStats:()=>N(b=>({...b,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>N(b=>({...b,barcode:null})),stop:j,start:()=>{m=!1,G(),d=setInterval(M,5e3)}}}async function Po(e){const{_deviceId:t,groupId:n,...o}=e,i=new TextEncoder().encode(JSON.stringify(o)),c=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(c)).map(m=>m.toString(16).padStart(2,"0")).join("")}function Eo(e){var n,o;return`${((((n=e==null?void 0:e.width)==null?void 0:n.max)||0)*(((o=e==null?void 0:e.height)==null?void 0:o.max)||0)/1e6).toFixed(2)} Mpix`}const Kn=async()=>{const t=(await navigator.mediaDevices.enumerateDevices()).filter(({kind:o})=>o==="videoinput");Pt("cameras",t);let n=[];for await(const o of t){const i=o.deviceId;try{const c=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:i}},audio:!1}),a=c.getTracks()[0],d=a.getConstraints(),m=a.getCapabilities(),$=await new ImageCapture(a).getPhotoCapabilities();c.getTracks().forEach(p=>p.stop()),i===m.deviceId&&n.push({camera:o,constraints:d,capabilities:m,photoCapabilities:$,hash:await Po(m)})}catch(c){console.log(c)}}return console.log("validCameras",n),Pt("validCameras",n),n},Lo=()=>{const{subscribe:e,update:t}=ct({cameras:[],selected:void 0});return{subscribe:e,getAvailableCameras:Kn,updateCameras:async()=>{const o=(await Kn()).map(({capabilities:i,hash:c})=>({value:c,label:Eo(i)}));console.log("cameras",o),t(i=>({...i,cameras:o}))},setActiveCamera:n=>{t(o=>({...o,selected:n}))}}};function Gn(e,t,n){const o=e.slice();return o[9]=t[n].value,o[26]=t[n].label,o[28]=n,o}function Wn(e){let t,n=e[26]+"",o,i;return{c(){t=u("option"),o=h(n),t.__value=i=e[9],$e(t,t.__value)},m(c,a){O(c,t,a),s(t,o)},p(c,a){a&256&&n!==(n=c[26]+"")&&A(o,n),a&256&&i!==(i=c[9])&&(t.__value=i,$e(t,t.__value))},d(c){c&&D(t)}}}function Bo(e){var un,dn,fn,pn,mn,gn,vn,hn,_n,bn,wn,yn,Cn,$n,Sn;let t,n,o,i=e[1].scanCount+"",c,a,d,m,l=e[1].average.toFixed(2)+"",$,p,_,C,F=e[1].fail+"",g,M,I,G,j=e[1].success+"",U,N,b,y,T=((un=e[7])==null?void 0:un.exposureTime)+"",R,De,oe,S,q=((dn=e[7])==null?void 0:dn.contrast)+"",Me,se,ie,Ut,Te=((fn=e[7])==null?void 0:fn.exposureMode)+"",lt,zt,qe,Ht,Ae=((pn=e[7])==null?void 0:pn.height)+"",rt,Jt,Oe,Rt,Ne=((mn=e[7])==null?void 0:mn.width)+"",ut,Vt,ke,Zt,Pe=((gn=e[7])==null?void 0:gn.resizeMode)+"",dt,Kt,Ee,Gt,Le=((vn=e[7])==null?void 0:vn.saturation)+"",ft,Wt,Be,Xt,je=((hn=e[7])==null?void 0:hn.sharpness)+"",pt,mt,V,gt,Ue,vt,z,ce,be,W,ze,Yt,ht,Qt,ae,P,He,xt,Z,_t,Je=((wn=(bn=(_n=e[0])==null?void 0:_n.capabilities)==null?void 0:bn.focusDistance)==null?void 0:wn.min.toFixed(2))+"",bt,en,wt,Re=(e[2]?e[2].toFixed(2):"-")+"",yt,tn,Ct,Ve=(($n=(Cn=(yn=e[0])==null?void 0:yn.capabilities)==null?void 0:Cn.focusDistance)==null?void 0:$n.max.toFixed(2))+"",$t,nn,le,we,X,Ze,on,St,Ft,H,Ke,Y,Q,Ge,We,sn,re,It,cn,Xe,B,x,an,ue,Ye=((Sn=e[1])==null?void 0:Sn.mode)+"",Dt,ln,ye,ee,Qe,Mt,rn,de=st(e[8].cameras),k=[];for(let r=0;r<de.length;r+=1)k[r]=Wn(Gn(e,de,r));return{c(){var r;t=u("div"),n=u("div"),o=h("Scan count: "),c=h(i),a=w(),d=u("div"),m=h("Average: "),$=h(l),p=w(),_=u("div"),C=h("Fail: "),g=h(F),M=w(),I=u("div"),G=h("Success: "),U=h(j),N=w(),b=u("div"),y=h("exposureTime: "),R=h(T),De=w(),oe=u("div"),S=h("Contrast "),Me=h(q),se=w(),ie=u("div"),Ut=h("exposureMode: "),lt=h(Te),zt=w(),qe=u("div"),Ht=h("height: "),rt=h(Ae),Jt=w(),Oe=u("div"),Rt=h("width: "),ut=h(Ne),Vt=w(),ke=u("div"),Zt=h("resizeMode: "),dt=h(Pe),Kt=w(),Ee=u("div"),Gt=h("saturation: "),ft=h(Le),Wt=w(),Be=u("div"),Xt=h("sharpness: "),pt=h(je),mt=w(),V=u("video"),V.innerHTML="",gt=w(),Ue=u("div"),vt=w(),z=u("div"),ce=u("div"),be=u("button"),W=u("img"),Yt=w(),ht=h(e[6]),Qt=w(),ae=u("div"),P=u("input"),xt=w(),Z=u("div"),_t=u("span"),bt=h(Je),en=w(),wt=u("span"),yt=h(Re),tn=w(),Ct=u("span"),$t=h(Ve),nn=w(),le=u("div"),we=u("button"),X=u("img"),on=w(),St=h(e[3]),Ft=w(),H=u("div"),Ke=u("div"),Y=u("button"),Q=u("img"),sn=w(),re=u("div"),It=u("div"),It.textContent="build 2024-04-05T08:55:23.320Z",cn=w(),Xe=u("div"),B=u("select"),x=u("option"),x.textContent="Choose camera";for(let v=0;v<k.length;v+=1)k[v].c();an=w(),ue=u("div"),Dt=h(Ye),ln=w(),ye=u("button"),ee=u("img"),f(t,"class","stats svelte-edqcw0"),V.autoplay=!0,f(V,"id","stream"),f(V,"class","svelte-edqcw0"),f(Ue,"class","overlay svelte-edqcw0"),K(W.src,ze=`public/${e[6]}-focus.svg`)||f(W,"src",ze),f(W,"class","svelte-edqcw0"),f(be,"class","svelte-edqcw0"),f(ce,"class","focus__group svelte-edqcw0"),P.disabled=He=e[6]==="continuous",f(P,"id","zoom__range"),f(P,"type","range"),f(P,"min","0"),f(P,"max","100"),f(P,"class","svelte-edqcw0"),f(Z,"class","focus__range svelte-edqcw0"),f(ae,"class","focus__group grow svelte-edqcw0"),K(X.src,Ze=`public/${e[3]}-facingMode.svg`)||f(X,"src",Ze),f(X,"class","svelte-edqcw0"),f(we,"class","svelte-edqcw0"),f(le,"class","focus__group svelte-edqcw0"),f(z,"id","focus"),f(z,"class","svelte-edqcw0"),K(Q.src,Ge=`public/torch-${e[4]?"on":"off"}.svg`)||f(Q,"src",Ge),f(Q,"class","svelte-edqcw0"),Y.disabled=We=!e[0]||!e[0].capabilities.torch,f(Y,"class","svelte-edqcw0"),f(Ke,"class","focus__group svelte-edqcw0"),x.__value="",$e(x,x.__value),x.disabled=!0,f(B,"class","svelte-edqcw0"),e[9]===void 0&&ot(()=>e[19].call(B)),f(Xe,"class","custom-select svelte-edqcw0"),f(re,"class","build svelte-edqcw0"),K(ee.src,Qe=`public/mode-${(r=e[1])==null?void 0:r.mode}.svg`)||f(ee,"src",Qe),f(ee,"class","svelte-edqcw0"),f(ye,"class","svelte-edqcw0"),f(ue,"class","focus__group svelte-edqcw0"),f(H,"id","toggles"),f(H,"class","svelte-edqcw0")},m(r,v){var Ce;O(r,t,v),s(t,n),s(n,o),s(n,c),s(t,a),s(t,d),s(d,m),s(d,$),s(t,p),s(t,_),s(_,C),s(_,g),s(t,M),s(t,I),s(I,G),s(I,U),s(t,N),s(t,b),s(b,y),s(b,R),s(t,De),s(t,oe),s(oe,S),s(oe,Me),s(t,se),s(t,ie),s(ie,Ut),s(ie,lt),s(t,zt),s(t,qe),s(qe,Ht),s(qe,rt),s(t,Jt),s(t,Oe),s(Oe,Rt),s(Oe,ut),s(t,Vt),s(t,ke),s(ke,Zt),s(ke,dt),s(t,Kt),s(t,Ee),s(Ee,Gt),s(Ee,ft),s(t,Wt),s(t,Be),s(Be,Xt),s(Be,pt),O(r,mt,v),O(r,V,v),e[17](V),O(r,gt,v),O(r,Ue,v),O(r,vt,v),O(r,z,v),s(z,ce),s(ce,be),s(be,W),s(ce,Yt),s(ce,ht),s(z,Qt),s(z,ae),s(ae,P),$e(P,e[9]),s(ae,xt),s(ae,Z),s(Z,_t),s(_t,bt),s(Z,en),s(Z,wt),s(wt,yt),s(Z,tn),s(Z,Ct),s(Ct,$t),s(z,nn),s(z,le),s(le,we),s(we,X),s(le,on),s(le,St),O(r,Ft,v),O(r,H,v),s(H,Ke),s(Ke,Y),s(Y,Q),s(H,sn),s(H,re),s(re,It),s(re,cn),s(re,Xe),s(Xe,B),s(B,x);for(let te=0;te<k.length;te+=1)k[te]&&k[te].m(B,null);Hn(B,e[9],!0),s(H,an),s(H,ue),s(ue,Dt),s(ue,ln),s(ue,ye),s(ye,ee),Mt||(rn=[J(be,"click",e[15]),J(P,"change",e[18]),J(P,"input",e[18]),J(P,"change",e[10]),J(we,"click",e[16]),J(Y,"click",e[11]),J(B,"change",e[19]),J(B,"change",e[14]),J(ye,"click",(Ce=e[13])==null?void 0:Ce.toggleMode)],Mt=!0)},p(r,[v]){var Ce,te,Fn,In,Dn,Mn,Tn,qn,An,On,Nn,kn,Pn,En,Ln,Bn;if(v&2&&i!==(i=r[1].scanCount+"")&&A(c,i),v&2&&l!==(l=r[1].average.toFixed(2)+"")&&A($,l),v&2&&F!==(F=r[1].fail+"")&&A(g,F),v&2&&j!==(j=r[1].success+"")&&A(U,j),v&128&&T!==(T=((Ce=r[7])==null?void 0:Ce.exposureTime)+"")&&A(R,T),v&128&&q!==(q=((te=r[7])==null?void 0:te.contrast)+"")&&A(Me,q),v&128&&Te!==(Te=((Fn=r[7])==null?void 0:Fn.exposureMode)+"")&&A(lt,Te),v&128&&Ae!==(Ae=((In=r[7])==null?void 0:In.height)+"")&&A(rt,Ae),v&128&&Ne!==(Ne=((Dn=r[7])==null?void 0:Dn.width)+"")&&A(ut,Ne),v&128&&Pe!==(Pe=((Mn=r[7])==null?void 0:Mn.resizeMode)+"")&&A(dt,Pe),v&128&&Le!==(Le=((Tn=r[7])==null?void 0:Tn.saturation)+"")&&A(ft,Le),v&128&&je!==(je=((qn=r[7])==null?void 0:qn.sharpness)+"")&&A(pt,je),v&64&&!K(W.src,ze=`public/${r[6]}-focus.svg`)&&f(W,"src",ze),v&64&&A(ht,r[6]),v&64&&He!==(He=r[6]==="continuous")&&(P.disabled=He),v&768&&$e(P,r[9]),v&1&&Je!==(Je=((Nn=(On=(An=r[0])==null?void 0:An.capabilities)==null?void 0:On.focusDistance)==null?void 0:Nn.min.toFixed(2))+"")&&A(bt,Je),v&4&&Re!==(Re=(r[2]?r[2].toFixed(2):"-")+"")&&A(yt,Re),v&1&&Ve!==(Ve=((En=(Pn=(kn=r[0])==null?void 0:kn.capabilities)==null?void 0:Pn.focusDistance)==null?void 0:En.max.toFixed(2))+"")&&A($t,Ve),v&8&&!K(X.src,Ze=`public/${r[3]}-facingMode.svg`)&&f(X,"src",Ze),v&8&&A(St,r[3]),v&16&&!K(Q.src,Ge=`public/torch-${r[4]?"on":"off"}.svg`)&&f(Q,"src",Ge),v&1&&We!==(We=!r[0]||!r[0].capabilities.torch)&&(Y.disabled=We),v&256){de=st(r[8].cameras);let L;for(L=0;L<de.length;L+=1){const jn=Gn(r,de,L);k[L]?k[L].p(jn,v):(k[L]=Wn(jn),k[L].c(),k[L].m(B,null))}for(;L<k.length;L+=1)k[L].d(1);k.length=de.length}v&768&&Hn(B,r[9]),v&2&&Ye!==(Ye=((Ln=r[1])==null?void 0:Ln.mode)+"")&&A(Dt,Ye),v&2&&!K(ee.src,Qe=`public/mode-${(Bn=r[1])==null?void 0:Bn.mode}.svg`)&&f(ee,"src",Qe)},i:E,o:E,d(r){r&&(D(t),D(mt),D(V),D(gt),D(Ue),D(vt),D(z),D(Ft),D(H)),e[17](null),eo(k,r),Mt=!1,_e(rn)}}}function jo(e,t,n){let o,i,c=0,a,d="environment",m=!1;async function l(S){console.log(S.target.value),n(9,c=S.target.value);const q=await(g==null?void 0:g.setFocusDistancePct(c));n(2,a=q||void 0)}async function $(){n(4,m=!m),await(g==null?void 0:g.setTorch(m))}const p=S=>{const q={video:{...S?{deviceId:{exact:S}}:{},facingMode:d,aspectRatio:{exact:1.7777777778}},audio:!1};return console.log("constraints",q),navigator.mediaDevices.getUserMedia(q)};let _,C,F,g,M=Lo();nt(e,M,S=>n(8,i=S));let I=ko();nt(e,I,S=>n(1,o=S));async function G(S){const q=S.target.value;console.log(q),M.setActiveCamera(q),await N(q)}const j=["continuous","manual"];let U="continuous";const N=async S=>{console.log("cameraHash",S);try{F==null||F.stop(),I==null||I.stop();let q;if(S){const se=(await M.getAvailableCameras()).find(ie=>ie.hash===S);if(console.log("found",se),!se){alert("Camera not found");return}q=se.camera.deviceId,console.log("deviceId",q)}C=await p(q),F=C.getVideoTracks()[0],n(5,_.srcObject=C,_),n(0,g=Ao(F)),I.init(_,F,_.width,_.height),I.start()}catch(q){console.log("error",q),alert("Could not access the camera")}},b=async()=>{const S=j[j.indexOf(U)+1]||j[0];try{await g.setFocusMode(U),n(6,U=S)}catch{alert("Could not set focus mode")}},y=async()=>{n(3,d=d==="environment"?"user":"environment"),await N()};po(()=>((async()=>(await M.updateCameras(),await N()))(),()=>I==null?void 0:I.stop()));let T;function R(S){Nt[S?"unshift":"push"](()=>{_=S,n(5,_)})}function De(){c=lo(this.value),n(9,c)}function oe(){c=uo(this),n(9,c)}return e.$$.update=()=>{e.$$.dirty&3&&(o==null||o.scanCount,n(7,T=g==null?void 0:g.getSettings()))},[g,o,a,d,m,_,U,T,i,c,l,$,M,I,G,b,y,R,De,oe]}class Uo extends jt{constructor(t){super(),Bt(this,t,jo,Bo,it,{})}}const At="deviceAlias",zo=()=>{const{subscribe:e,set:t}=ct(localStorage.getItem(At));return{subscribe:e,ask:()=>{if(localStorage.getItem(At))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(At,n),t(n)):alert("You must provide a device alias")}}},Xn=zo();function Ho(e){let t;return{c(){t=u("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){O(n,t,o)},d(n){n&&D(t)}}}function Jo(e){let t;return{c(){t=u("h1"),t.textContent="Waiting for device alias..."},m(n,o){O(n,t,o)},i:E,o:E,d(n){n&&D(t)}}}function Ro(e){let t,n;return t=new Uo({}),{c(){no(t.$$.fragment)},m(o,i){Et(t,o,i),n=!0},i(o){n||(Fe(t.$$.fragment,o),n=!0)},o(o){tt(t.$$.fragment,o),n=!1},d(o){Lt(t,o)}}}function Vo(e){let t,n,o,i,c,a,d,m,l,$;o=new Io({});let p=!e[1]&&Ho();const _=[Ro,Jo],C=[];function F(g,M){return g[0]?0:1}return d=F(e),m=C[d]=_[d](e),{c(){t=u("meta"),n=w(),no(o.$$.fragment),i=w(),c=u("main"),p&&p.c(),a=w(),m.c(),l=ao(),f(t,"name","viewport"),f(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(g,M){s(document.head,t),O(g,n,M),Et(o,g,M),O(g,i,M),O(g,c,M),p&&p.m(c,null),O(g,a,M),C[d].m(g,M),O(g,l,M),$=!0},p(g,[M]){let I=d;d=F(g),d!==I&&(_o(),tt(C[I],1,1,()=>{C[I]=null}),bo(),m=C[d],m||(m=C[d]=_[d](g),m.c()),Fe(m,1),m.m(l.parentNode,l))},i(g){$||(Fe(o.$$.fragment,g),Fe(m),$=!0)},o(g){tt(o.$$.fragment,g),tt(m),$=!1},d(g){g&&(D(n),D(i),D(c),D(a),D(l)),D(t),Lt(o,g),p&&p.d(),C[d].d(g)}}}function Zo(e,t,n){let o;nt(e,Xn,c=>n(0,o=c));const i=typeof BarcodeDetector<"u";return Xn.ask(),[o,i]}class Ko extends jt{constructor(t){super(),Bt(this,t,Zo,Vo,it,{})}}const Ot="0.0.17",Yn=localStorage.getItem("version");Ot!==Yn&&(localStorage.setItem("version",Ot),alert(`New version detected ${Yn}>${Ot}!`));new Ko({target:document.getElementById("app")});
