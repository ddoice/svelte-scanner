var Ee=Object.defineProperty;var Ae=(e,t,n)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ie=(e,t,n)=>(Ae(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function I(){}function Ne(e){return e()}function $e(){return Object.create(null)}function R(e){e.forEach(Ne)}function Te(e){return typeof e=="function"}function ne(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let Q;function we(e,t){return e===t?!0:(Q||(Q=document.createElement("a")),Q.href=t,e===Q.href)}function je(e){return Object.keys(e).length===0}function Le(e,...t){if(e==null){for(const o of t)o(void 0);return I}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function fe(e,t,n){e.$$.on_destroy.push(Le(t,n))}function Se(e){return e??""}function m(e,t){e.appendChild(t)}function P(e,t,n){e.insertBefore(t,n||null)}function F(e){e.parentNode&&e.parentNode.removeChild(e)}function Be(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function $(e){return document.createElement(e)}function N(e){return document.createTextNode(e)}function T(){return N(" ")}function qe(){return N("")}function J(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function b(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ue(e){return e===""?null:+e}function ze(e){return Array.from(e.childNodes)}function q(e,t){t=""+t,e.data!==t&&(e.data=t)}function Ce(e,t){e.value=t??""}let W;function K(e){W=e}function Re(){if(!W)throw new Error("Function called outside component initialization");return W}function Ve(e){Re().$$.on_mount.push(e)}const U=[],ue=[];let z=[];const Fe=[],He=Promise.resolve();let ae=!1;function Je(){ae||(ae=!0,He.then(xe))}function le(e){z.push(e)}const ce=new Set;let L=0;function xe(){if(L!==0)return;const e=W;do{try{for(;L<U.length;){const t=U[L];L++,K(t),Ke(t.$$)}}catch(t){throw U.length=0,L=0,t}for(K(null),U.length=0,L=0;ue.length;)ue.pop()();for(let t=0;t<z.length;t+=1){const n=z[t];ce.has(n)||(ce.add(n),n())}z.length=0}while(U.length);for(;Fe.length;)Fe.pop()();ae=!1,ce.clear(),K(e)}function Ke(e){if(e.fragment!==null){e.update(),R(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(le)}}function Ze(e){const t=[],n=[];z.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),z=t}const ee=new Set;let E;function We(){E={r:0,c:[],p:E}}function Xe(){E.r||R(E.c),E=E.p}function Z(e,t){e&&e.i&&(ee.delete(e),e.i(t))}function te(e,t,n,o){if(e&&e.o){if(ee.has(e))return;ee.add(e),E.c.push(()=>{ee.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function De(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Me(e){e&&e.c()}function de(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),le(()=>{const i=e.$$.on_mount.map(Ne).filter(Te);e.$$.on_destroy?e.$$.on_destroy.push(...i):R(i),e.$$.on_mount=[]}),s.forEach(le)}function pe(e,t){const n=e.$$;n.fragment!==null&&(Ze(n.after_update),R(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ye(e,t){e.$$.dirty[0]===-1&&(U.push(e),Je(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function me(e,t,n,o,s,i,r=null,a=[-1]){const l=W;K(e);const c=e.$$={fragment:null,ctx:[],props:i,update:I,not_equal:s,bound:$e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:$e(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};r&&r(c.root);let _=!1;if(c.ctx=n?n(e,t.props||{},(u,d,...g)=>{const D=g.length?g[0]:d;return c.ctx&&s(c.ctx[u],c.ctx[u]=D)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](D),_&&Ye(e,u)),d}):[],c.update(),_=!0,R(c.before_update),c.fragment=o?o(c.ctx):!1,t.target){if(t.hydrate){const u=ze(t.target);c.fragment&&c.fragment.l(u),u.forEach(F)}else c.fragment&&c.fragment.c();t.intro&&Z(e.$$.fragment),de(e,t.target,t.anchor),xe()}K(l)}class ge{constructor(){ie(this,"$$");ie(this,"$$set")}$destroy(){pe(this,1),this.$destroy=I}$on(t,n){if(!Te(n))return I;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!je(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ge="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ge);const B=[];function he(e,t=I){let n;const o=new Set;function s(a){if(ne(e,a)&&(e=a,n)){const l=!B.length;for(const c of o)c[1](),B.push(c,e);if(l){for(let c=0;c<B.length;c+=2)B[c][0](B[c+1]);B.length=0}}}function i(a){s(a(e))}function r(a,l=I){const c=[a,l];return o.add(c),o.size===1&&(n=t(s,i)||I),a(e),()=>{o.delete(c),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:r}}let Oe=0;const Qe=3e3;function et(){const{subscribe:e,update:t}=he([]);function n(s){Oe+=1;const i=Oe,r={...s,id:i};t(a=>[...a,r].slice(-5)),setTimeout(()=>{o(i)},Qe)}function o(s){t(i=>i.filter(r=>r.id!==s))}return{subscribe:e,addNotification:n,closeNotification:o}}const X=et();function ke(e,t,n){const o=e.slice();return o[2]=t[n],o}function Pe(e){let t,n,o=e[2].text+"",s,i,r,a,l,c,_;function u(){return e[1](e[2])}return{c(){t=$("div"),n=$("div"),s=N(o),i=T(),r=$("button"),r.textContent="X",a=T(),b(r,"class","svelte-1mipv5u"),b(t,"class",l=Se(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(d,g){P(d,t,g),m(t,n),m(n,s),m(t,i),m(t,r),m(t,a),c||(_=J(r,"click",u),c=!0)},p(d,g){e=d,g&1&&o!==(o=e[2].text+"")&&q(s,o),g&1&&l!==(l=Se(`notification ${e[2].type}`)+" svelte-1mipv5u")&&b(t,"class",l)},d(d){d&&F(t),c=!1,_()}}}function tt(e){let t,n=De(e[0]),o=[];for(let s=0;s<n.length;s+=1)o[s]=Pe(ke(e,n,s));return{c(){t=$("div");for(let s=0;s<o.length;s+=1)o[s].c();b(t,"id","notifications-container"),b(t,"class","svelte-1mipv5u")},m(s,i){P(s,t,i);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(t,null)},p(s,[i]){if(i&1){n=De(s[0]);let r;for(r=0;r<n.length;r+=1){const a=ke(s,n,r);o[r]?o[r].p(a,i):(o[r]=Pe(a),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},i:I,o:I,d(s){s&&F(t),Be(o,s)}}}function nt(e,t,n){let o;return fe(e,X,i=>n(0,o=i)),[o,i=>X.closeNotification(i.id)]}class ot extends ge{constructor(t){super(),me(this,t,nt,tt,ne,{})}}const st="https://yup.perfdive.com/api",_e=async(e,t)=>{const n=await fetch(`${st}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},it=async e=>{try{return await _e("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),X.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},ct=async e=>{try{return await _e("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),X.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},rt=async e=>{const t=new FormData;t.append("photo",e);try{const n=await _e("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),X.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},ut=e=>{const t=e.getCapabilities(),n=e.getSettings();return it(t),ct(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:u}=t;return u&&(u.max-u.min)/u.step,u},getSettings:()=>e.getSettings(),setFocusMode:u=>e.applyConstraints({advanced:[{focusMode:u}]}),setFocusDistance:u=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:u}]}),setTorch:u=>{t.torch&&e.applyConstraints({advanced:[{torch:u}]})},settings:n,setFocusDistancePct:u=>{const{focusDistance:d}=t;if(!d){alert("Focus distance not supported");return}const g=d.min+(d.max-d.min)*u;return e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:g}]})},setZoom:u=>e.applyConstraints({advanced:[{zoom:u}]})}};function at(){const e=["grabFrame","videoCapture","takePhoto"];let t="grabFrame",n=0,o=0,s=0,i=0,r=0,a,l=!1,c=null,_,u,d;function g(h,f,y,x){d=h,_=new ImageCapture(f),u=new BarcodeDetector({formats:["pdf417"]})}async function D(){if(t==="grabFrame")return _.grabFrame();if(t==="videoCapture")return d;if(t==="takePhoto"){const h=await _.takePhoto(),f=new Image;return f.src=URL.createObjectURL(h),await new Promise(y=>{f.onload=y}),f}}async function p(){const h=await D();return await u.detect(h)}async function S(){const h=await _.grabFrame(),f=document.createElement("canvas"),y=f.getContext("2d");f.width=h.width,f.height=h.height,y.drawImage(h,0,0),f.toBlob(x=>{rt(x)})}function v(h){const f=Date.now()-h;i+=1,r=i>1?(r*(i-1)+f)/i:f,w(y=>({...y,scanCount:i,average:r}))}async function A(){try{const h=Date.now(),f=await p();if(l)return;v(h),f.length>0?(n+=1,c=f[0].rawValue,w(y=>({...y,barcode:c,success:n}))):(o+=1,w(y=>({...y,fail:o})))}catch(h){s+=1,w(f=>({...f,error:s})),console.log(h)}finally{setTimeout(A,100)}}function j(){l=!0}function V(){l=!0,clearInterval(a),j()}const{subscribe:H,update:w}=he({mode:t,success:n,fail:o,barcode:c,scanCount:i,error:s,average:r,toggleMode:()=>{const f=(e.indexOf(t)+1)%e.length;t=e[f],w(y=>({...y,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{c=null}});return{init:g,subscribe:H,toggleMode:()=>w(h=>({...h,mode:e[(e.indexOf(h.mode)+1)%e.length]})),resetStats:()=>w(h=>({...h,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>w(h=>({...h,barcode:null})),stop:V,start:()=>{A(),a=setInterval(S,5e3)}}}function lt(e){let t,n,o,s=e[3].scanCount+"",i,r,a,l,c=e[3].average.toFixed(2)+"",_,u,d,g,D=e[3].fail+"",p,S,v,A,j=e[3].success+"",V,H,w,h,f,y,x,M,Y,ve,oe,be,O,G,se,ye;return{c(){t=$("div"),n=$("div"),o=N("Scan count: "),i=N(s),r=T(),a=$("div"),l=N("Average: "),_=N(c),u=T(),d=$("div"),g=N("Fail: "),p=N(D),S=T(),v=$("div"),A=N("Success: "),V=N(j),H=T(),w=$("video"),w.innerHTML="",h=T(),f=$("div"),y=$("div"),x=$("button"),M=$("img"),ve=T(),oe=N(e[2]),be=T(),O=$("input"),b(t,"class","stats svelte-1j6s9c"),w.autoplay=!0,b(w,"id","stream"),b(w,"class","svelte-1j6s9c"),we(M.src,Y=`public/${e[2]}-focus.svg`)||b(M,"src",Y),b(M,"class","svelte-1j6s9c"),b(y,"id","focus__button"),b(y,"class","svelte-1j6s9c"),O.disabled=G=e[2]==="continuous",b(O,"id","zoom__range"),b(O,"type","range"),b(O,"min","0"),b(O,"max","100"),b(O,"class","svelte-1j6s9c"),b(f,"id","focus"),b(f,"class","svelte-1j6s9c")},m(C,k){P(C,t,k),m(t,n),m(n,o),m(n,i),m(t,r),m(t,a),m(a,l),m(a,_),m(t,u),m(t,d),m(d,g),m(d,p),m(t,S),m(t,v),m(v,A),m(v,V),P(C,H,k),P(C,w,k),e[7](w),P(C,h,k),P(C,f,k),m(f,y),m(y,x),m(x,M),m(y,ve),m(y,oe),m(f,be),m(f,O),Ce(O,e[0]),se||(ye=[J(x,"click",e[6]),J(O,"change",e[8]),J(O,"input",e[8]),J(O,"change",e[4])],se=!0)},p(C,[k]){k&8&&s!==(s=C[3].scanCount+"")&&q(i,s),k&8&&c!==(c=C[3].average.toFixed(2)+"")&&q(_,c),k&8&&D!==(D=C[3].fail+"")&&q(p,D),k&8&&j!==(j=C[3].success+"")&&q(V,j),k&4&&!we(M.src,Y=`public/${C[2]}-focus.svg`)&&b(M,"src",Y),k&4&&q(oe,C[2]),k&4&&G!==(G=C[2]==="continuous")&&(O.disabled=G),k&1&&Ce(O,C[0])},i:I,o:I,d(C){C&&(F(t),F(H),F(w),F(h),F(f)),e[7](null),se=!1,R(ye)}}}function ft(e,t,n){let o,s=0;function i(v){console.log(v.target.value),n(0,s=v.target.value),_==null||_.setFocusDistancePct(s)}const r=()=>navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:960},height:{ideal:1280}},audio:!1});let a,l,c,_,u=at();fe(e,u,v=>n(3,o=v));const d=["continuous","manual"];let g="continuous";const D=async()=>{const v=d[d.indexOf(g)+1]||d[0];try{await _.setFocusMode(g),n(2,g=v)}catch{alert("Could not set focus mode")}};Ve(()=>((async()=>{try{l=await r(),n(1,a.srcObject=l,a),c=l.getVideoTracks()[0],_=ut(c),u.init(a,c,a.width,a.height),u.start()}catch(v){console.log("error",v),alert("Could not access the camera")}})(),()=>u==null?void 0:u.stop()));function p(v){ue[v?"unshift":"push"](()=>{a=v,n(1,a)})}function S(){s=Ue(this.value),n(0,s)}return[s,a,g,o,i,u,D,p,S]}class dt extends ge{constructor(t){super(),me(this,t,ft,lt,ne,{})}}const re="deviceAlias",pt=()=>{const{subscribe:e,set:t}=he(localStorage.getItem(re));return{subscribe:e,ask:()=>{if(localStorage.getItem(re))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(re,n),t(n)):alert("You must provide a device alias")}}},Ie=pt();function mt(e){let t;return{c(){t=$("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){P(n,t,o)},d(n){n&&F(t)}}}function gt(e){let t;return{c(){t=$("h1"),t.textContent="Waiting for device alias..."},m(n,o){P(n,t,o)},i:I,o:I,d(n){n&&F(t)}}}function ht(e){let t,n;return t=new dt({}),{c(){Me(t.$$.fragment)},m(o,s){de(t,o,s),n=!0},i(o){n||(Z(t.$$.fragment,o),n=!0)},o(o){te(t.$$.fragment,o),n=!1},d(o){pe(t,o)}}}function _t(e){let t,n,o,s,i,r,a,l,c,_;o=new ot({});let u=!e[1]&&mt();const d=[ht,gt],g=[];function D(p,S){return p[0]?0:1}return a=D(e),l=g[a]=d[a](e),{c(){t=$("meta"),n=T(),Me(o.$$.fragment),s=T(),i=$("main"),u&&u.c(),r=T(),l.c(),c=qe(),b(t,"name","viewport"),b(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(p,S){m(document.head,t),P(p,n,S),de(o,p,S),P(p,s,S),P(p,i,S),u&&u.m(i,null),P(p,r,S),g[a].m(p,S),P(p,c,S),_=!0},p(p,[S]){let v=a;a=D(p),a!==v&&(We(),te(g[v],1,1,()=>{g[v]=null}),Xe(),l=g[a],l||(l=g[a]=d[a](p),l.c()),Z(l,1),l.m(c.parentNode,c))},i(p){_||(Z(o.$$.fragment,p),Z(l),_=!0)},o(p){te(o.$$.fragment,p),te(l),_=!1},d(p){p&&(F(n),F(s),F(i),F(r),F(c)),F(t),pe(o,p),u&&u.d(),g[a].d(p)}}}function vt(e,t,n){let o;fe(e,Ie,i=>n(0,o=i));const s=typeof BarcodeDetector<"u";return Ie.ask(),[o,s]}class bt extends ge{constructor(t){super(),me(this,t,vt,_t,ne,{})}}new bt({target:document.getElementById("app")});
