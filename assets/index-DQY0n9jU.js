var wt=Object.defineProperty;var $t=(e,t,n)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Oe=(e,t,n)=>($t(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function N(){}function _t(e){return e()}function lt(){return Object.create(null)}function Q(e){e.forEach(_t)}function vt(e){return typeof e=="function"}function ve(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let me;function K(e,t){return e===t?!0:(me||(me=document.createElement("a")),me.href=t,e===me.href)}function St(e){return Object.keys(e).length===0}function Ft(e,...t){if(e==null){for(const o of t)o(void 0);return N}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Ae(e,t,n){e.$$.on_destroy.push(Ft(t,n))}function at(e){return e??""}function a(e,t){e.appendChild(t)}function M(e,t,n){e.insertBefore(t,n||null)}function D(e){e.parentNode&&e.parentNode.removeChild(e)}function Ct(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function h(e){return document.createElement(e)}function T(e){return document.createTextNode(e)}function C(){return T(" ")}function Dt(){return T("")}function R(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function g(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Tt(e){return e===""?null:+e}function Mt(e){return Array.from(e.childNodes)}function k(e,t){t=""+t,e.data!==t&&(e.data=t)}function ut(e,t){e.value=t??""}let se;function ne(e){se=e}function Ot(){if(!se)throw new Error("Function called outside component initialization");return se}function Pt(e){Ot().$$.on_mount.push(e)}const Y=[],Ne=[];let G=[];const ft=[],It=Promise.resolve();let ke=!1;function Nt(){ke||(ke=!0,It.then(bt))}function Ee(e){G.push(e)}const Pe=new Set;let W=0;function bt(){if(W!==0)return;const e=se;do{try{for(;W<Y.length;){const t=Y[W];W++,ne(t),kt(t.$$)}}catch(t){throw Y.length=0,W=0,t}for(ne(null),Y.length=0,W=0;Ne.length;)Ne.pop()();for(let t=0;t<G.length;t+=1){const n=G[t];Pe.has(n)||(Pe.add(n),n())}G.length=0}while(Y.length);for(;ft.length;)ft.pop()();ke=!1,Pe.clear(),ne(e)}function kt(e){if(e.fragment!==null){e.update(),Q(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ee)}}function Et(e){const t=[],n=[];G.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),G=t}const he=new Set;let V;function At(){V={r:0,c:[],p:V}}function Lt(){V.r||Q(V.c),V=V.p}function oe(e,t){e&&e.i&&(he.delete(e),e.i(t))}function _e(e,t,n,o){if(e&&e.o){if(he.has(e))return;he.add(e),V.c.push(()=>{he.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function dt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function yt(e){e&&e.c()}function Le(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),Ee(()=>{const i=e.$$.on_mount.map(_t).filter(vt);e.$$.on_destroy?e.$$.on_destroy.push(...i):Q(i),e.$$.on_mount=[]}),s.forEach(Ee)}function Be(e,t){const n=e.$$;n.fragment!==null&&(Et(n.after_update),Q(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Bt(e,t){e.$$.dirty[0]===-1&&(Y.push(e),Nt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function je(e,t,n,o,s,i,c=null,u=[-1]){const m=se;ne(e);const r=e.$$={fragment:null,ctx:[],props:i,update:N,not_equal:s,bound:lt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(m?m.$$.context:[])),callbacks:lt(),dirty:u,skip_bound:!1,root:t.target||m.$$.root};c&&c(r.root);let S=!1;if(r.ctx=n?n(e,t.props||{},(l,v,..._)=>{const w=_.length?_[0]:v;return r.ctx&&s(r.ctx[l],r.ctx[l]=w)&&(!r.skip_bound&&r.bound[l]&&r.bound[l](w),S&&Bt(e,l)),v}):[],r.update(),S=!0,Q(r.before_update),r.fragment=o?o(r.ctx):!1,t.target){if(t.hydrate){const l=Mt(t.target);r.fragment&&r.fragment.l(l),l.forEach(D)}else r.fragment&&r.fragment.c();t.intro&&oe(e.$$.fragment),Le(e,t.target,t.anchor),bt()}ne(m)}class xe{constructor(){Oe(this,"$$");Oe(this,"$$set")}$destroy(){Be(this,1),this.$destroy=N}$on(t,n){if(!vt(n))return N;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!St(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const jt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(jt);const X=[];function qe(e,t=N){let n;const o=new Set;function s(u){if(ve(e,u)&&(e=u,n)){const m=!X.length;for(const r of o)r[1](),X.push(r,e);if(m){for(let r=0;r<X.length;r+=2)X[r][0](X[r+1]);X.length=0}}}function i(u){s(u(e))}function c(u,m=N){const r=[u,m];return o.add(r),o.size===1&&(n=t(s,i)||N),u(e),()=>{o.delete(r),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:c}}let pt=0;const xt=3e3;function qt(){const{subscribe:e,update:t}=qe([]);function n(s){pt+=1;const i=pt,c={...s,id:i};t(u=>[...u,c].slice(-5)),setTimeout(()=>{o(i)},xt)}function o(s){t(i=>i.filter(c=>c.id!==s))}return{subscribe:e,addNotification:n,closeNotification:o}}const ie=qt();function gt(e,t,n){const o=e.slice();return o[2]=t[n],o}function mt(e){let t,n,o=e[2].text+"",s,i,c,u,m,r,S;function l(){return e[1](e[2])}return{c(){t=h("div"),n=h("div"),s=T(o),i=C(),c=h("button"),c.textContent="X",u=C(),g(c,"class","svelte-1mipv5u"),g(t,"class",m=at(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(v,_){M(v,t,_),a(t,n),a(n,s),a(t,i),a(t,c),a(t,u),r||(S=R(c,"click",l),r=!0)},p(v,_){e=v,_&1&&o!==(o=e[2].text+"")&&k(s,o),_&1&&m!==(m=at(`notification ${e[2].type}`)+" svelte-1mipv5u")&&g(t,"class",m)},d(v){v&&D(t),r=!1,S()}}}function zt(e){let t,n=dt(e[0]),o=[];for(let s=0;s<n.length;s+=1)o[s]=mt(gt(e,n,s));return{c(){t=h("div");for(let s=0;s<o.length;s+=1)o[s].c();g(t,"id","notifications-container"),g(t,"class","svelte-1mipv5u")},m(s,i){M(s,t,i);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(t,null)},p(s,[i]){if(i&1){n=dt(s[0]);let c;for(c=0;c<n.length;c+=1){const u=gt(s,n,c);o[c]?o[c].p(u,i):(o[c]=mt(u),o[c].c(),o[c].m(t,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=n.length}},i:N,o:N,d(s){s&&D(t),Ct(o,s)}}}function Ut(e,t,n){let o;return Ae(e,ie,i=>n(0,o=i)),[o,i=>ie.closeNotification(i.id)]}class Rt extends xe{constructor(t){super(),je(this,t,Ut,zt,ve,{})}}const Vt="https://yup.perfdive.com/api",ze=async(e,t)=>{const n=await fetch(`${Vt}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},Zt=async e=>{try{return await ze("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),ie.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},Ht=async e=>{try{return await ze("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),ie.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},Jt=async e=>{const t=new FormData;t.append("photo",e);try{const n=await ze("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),ie.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},Kt=e=>{const t=e.getCapabilities(),n=e.getSettings();return Zt(t),Ht(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:l}=t;return l&&(l.max-l.min)/l.step,l},getSettings:()=>e.getSettings(),setFocusMode:l=>e.applyConstraints({advanced:[{focusMode:l}]}),setFocusDistance:l=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:l}]}),setTorch:l=>{t.torch&&e.applyConstraints({advanced:[{torch:l}]})},settings:n,setFocusDistancePct:async l=>{const{focusDistance:v}=t;if(!v){alert("Focus distance not supported");return}const _=(v.max-v.min)/100,w=v.min+_*l;try{await e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:w}]})}catch(f){alert(f.message),console.error(f)}return w},setZoom:l=>e.applyConstraints({advanced:[{zoom:l}]})}};function Wt(){const e=["grabFrame","videoCapture","takePhoto"];let t="grabFrame",n=0,o=0,s=0,i=0,c=0,u,m=!1,r=null,S,l,v;function _(p,d,y,E){v=p,S=new ImageCapture(d),l=new BarcodeDetector({formats:["pdf417"]})}async function w(){if(t==="grabFrame")return S.grabFrame();if(t==="videoCapture")return v;if(t==="takePhoto"){const p=await S.takePhoto(),d=new Image;return d.src=URL.createObjectURL(p),await new Promise(y=>{d.onload=y}),d}}async function f(){const p=await w();return await l.detect(p)}async function F(){try{const p=await S.grabFrame(),d=document.createElement("canvas"),y=d.getContext("2d");d.width=p.width,d.height=p.height,y.drawImage(p,0,0),d.toBlob(E=>{Jt(E)})}catch(p){console.log(p)}}function O(p){const d=Date.now()-p;i+=1,c=i>1?(c*(i-1)+d)/i:d,P(y=>({...y,scanCount:i,average:c}))}async function A(){try{const p=Date.now(),d=await f();if(m)return;O(p),d.length>0?(n+=1,r=d[0].rawValue,P(y=>({...y,barcode:r,success:n}))):(o+=1,P(y=>({...y,fail:o})))}catch(p){s+=1,P(d=>({...d,error:s})),console.log(p)}finally{setTimeout(A,100)}}function L(){m=!0,clearInterval(u)}const{subscribe:j,update:P}=qe({mode:t,success:n,fail:o,barcode:r,scanCount:i,error:s,average:c,toggleMode:()=>{const d=(e.indexOf(t)+1)%e.length;t=e[d],P(y=>({...y,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{r=null}});return{init:_,subscribe:j,toggleMode:()=>P(p=>({...p,mode:e[(e.indexOf(p.mode)+1)%e.length]})),resetStats:()=>P(p=>({...p,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>P(p=>({...p,barcode:null})),stop:L,start:()=>{m=!1,A(),u=setInterval(F,5e3)}}}function Xt(e){var Xe,Ye,Ge,Qe,et,tt;let t,n,o,s=e[7].scanCount+"",i,c,u,m,r=e[7].average.toFixed(2)+"",S,l,v,_,w=e[7].fail+"",f,F,O,A,L=e[7].success+"",j,P,p,d,y,E,ee,x,ce,Ue,be,Re,Z,I,re,Ve,B,ye,le=((Ge=(Ye=(Xe=e[5])==null?void 0:Xe.capabilities)==null?void 0:Ye.focusDistance)==null?void 0:Ge.min.toFixed(2))+"",we,Ze,$e,ae=(e[1]?e[1].toFixed(2):"-")+"",Se,He,Fe,ue=((tt=(et=(Qe=e[5])==null?void 0:Qe.capabilities)==null?void 0:et.focusDistance)==null?void 0:tt.max.toFixed(2))+"",Ce,Je,H,te,q,fe,Ke,De,Te,J,de,z,U,pe,ge,Me,We;return{c(){t=h("div"),n=h("div"),o=T("Scan count: "),i=T(s),c=C(),u=h("div"),m=T("Average: "),S=T(r),l=C(),v=h("div"),_=T("Fail: "),f=T(w),F=C(),O=h("div"),A=T("Success: "),j=T(L),P=C(),p=h("video"),p.innerHTML="",d=C(),y=h("div"),E=h("div"),ee=h("button"),x=h("img"),Ue=C(),be=T(e[6]),Re=C(),Z=h("div"),I=h("input"),Ve=C(),B=h("div"),ye=h("span"),we=T(le),Ze=C(),$e=h("span"),Se=T(ae),He=C(),Fe=h("span"),Ce=T(ue),Je=C(),H=h("div"),te=h("button"),q=h("img"),Ke=C(),De=T(e[2]),Te=C(),J=h("div"),de=h("div"),z=h("button"),U=h("img"),g(t,"class","stats svelte-d9pg8m"),p.autoplay=!0,g(p,"id","stream"),g(p,"class","svelte-d9pg8m"),K(x.src,ce=`public/${e[6]}-focus.svg`)||g(x,"src",ce),g(x,"class","svelte-d9pg8m"),g(ee,"class","svelte-d9pg8m"),g(E,"class","focus__group svelte-d9pg8m"),I.disabled=re=e[6]==="continuous",g(I,"id","zoom__range"),g(I,"type","range"),g(I,"min","0"),g(I,"max","100"),g(I,"class","svelte-d9pg8m"),g(B,"class","focus__range svelte-d9pg8m"),g(Z,"class","focus__group grow svelte-d9pg8m"),K(q.src,fe=`public/${e[2]}-facingMode.svg`)||g(q,"src",fe),g(q,"class","svelte-d9pg8m"),g(te,"class","svelte-d9pg8m"),g(H,"class","focus__group svelte-d9pg8m"),g(y,"id","focus"),g(y,"class","svelte-d9pg8m"),K(U.src,pe=`public/torch-${e[3]?"on":"off"}.svg`)||g(U,"src",pe),g(U,"class","svelte-d9pg8m"),z.disabled=ge=!e[5]||!e[5].capabilities.torch,g(z,"class","svelte-d9pg8m"),g(de,"class","focus__group svelte-d9pg8m"),g(J,"id","toggles"),g(J,"class","svelte-d9pg8m")},m(b,$){M(b,t,$),a(t,n),a(n,o),a(n,i),a(t,c),a(t,u),a(u,m),a(u,S),a(t,l),a(t,v),a(v,_),a(v,f),a(t,F),a(t,O),a(O,A),a(O,j),M(b,P,$),M(b,p,$),e[13](p),M(b,d,$),M(b,y,$),a(y,E),a(E,ee),a(ee,x),a(E,Ue),a(E,be),a(y,Re),a(y,Z),a(Z,I),ut(I,e[0]),a(Z,Ve),a(Z,B),a(B,ye),a(ye,we),a(B,Ze),a(B,$e),a($e,Se),a(B,He),a(B,Fe),a(Fe,Ce),a(y,Je),a(y,H),a(H,te),a(te,q),a(H,Ke),a(H,De),M(b,Te,$),M(b,J,$),a(J,de),a(de,z),a(z,U),Me||(We=[R(ee,"click",e[11]),R(I,"change",e[14]),R(I,"input",e[14]),R(I,"change",e[8]),R(te,"click",e[12]),R(z,"click",e[9])],Me=!0)},p(b,[$]){var nt,ot,st,it,ct,rt;$&128&&s!==(s=b[7].scanCount+"")&&k(i,s),$&128&&r!==(r=b[7].average.toFixed(2)+"")&&k(S,r),$&128&&w!==(w=b[7].fail+"")&&k(f,w),$&128&&L!==(L=b[7].success+"")&&k(j,L),$&64&&!K(x.src,ce=`public/${b[6]}-focus.svg`)&&g(x,"src",ce),$&64&&k(be,b[6]),$&64&&re!==(re=b[6]==="continuous")&&(I.disabled=re),$&1&&ut(I,b[0]),$&32&&le!==(le=((st=(ot=(nt=b[5])==null?void 0:nt.capabilities)==null?void 0:ot.focusDistance)==null?void 0:st.min.toFixed(2))+"")&&k(we,le),$&2&&ae!==(ae=(b[1]?b[1].toFixed(2):"-")+"")&&k(Se,ae),$&32&&ue!==(ue=((rt=(ct=(it=b[5])==null?void 0:it.capabilities)==null?void 0:ct.focusDistance)==null?void 0:rt.max.toFixed(2))+"")&&k(Ce,ue),$&4&&!K(q.src,fe=`public/${b[2]}-facingMode.svg`)&&g(q,"src",fe),$&4&&k(De,b[2]),$&8&&!K(U.src,pe=`public/torch-${b[3]?"on":"off"}.svg`)&&g(U,"src",pe),$&32&&ge!==(ge=!b[5]||!b[5].capabilities.torch)&&(z.disabled=ge)},i:N,o:N,d(b){b&&(D(t),D(P),D(p),D(d),D(y),D(Te),D(J)),e[13](null),Me=!1,Q(We)}}}function Yt(e,t,n){let o,s=0,i,c="environment",u=!1;async function m(d){console.log(d.target.value),n(0,s=d.target.value);const y=await(w==null?void 0:w.setFocusDistancePct(s));n(1,i=y||void 0)}async function r(){n(3,u=!u),await(w==null?void 0:w.setTorch(u))}const S=()=>navigator.mediaDevices.getUserMedia({video:{facingMode:c,width:{ideal:960},height:{ideal:1280}},audio:!1});let l,v,_,w,f=Wt();Ae(e,f,d=>n(7,o=d));const F=["continuous","manual"];let O="continuous";const A=async()=>{try{_==null||_.stop(),f==null||f.stop(),v=await S(),n(4,l.srcObject=v,l),_=v.getVideoTracks()[0],n(5,w=Kt(_)),f.init(l,_,l.width,l.height),f.start()}catch(d){console.log("error",d),alert("Could not access the camera")}},L=async()=>{const d=F[F.indexOf(O)+1]||F[0];try{await w.setFocusMode(O),n(6,O=d)}catch{alert("Could not set focus mode")}},j=async()=>{n(2,c=c==="environment"?"user":"environment"),await A()};Pt(()=>((async()=>await A())(),()=>f==null?void 0:f.stop()));function P(d){Ne[d?"unshift":"push"](()=>{l=d,n(4,l)})}function p(){s=Tt(this.value),n(0,s)}return[s,i,c,u,l,w,O,o,m,r,f,L,j,P,p]}class Gt extends xe{constructor(t){super(),je(this,t,Yt,Xt,ve,{})}}const Ie="deviceAlias",Qt=()=>{const{subscribe:e,set:t}=qe(localStorage.getItem(Ie));return{subscribe:e,ask:()=>{if(localStorage.getItem(Ie))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(Ie,n),t(n)):alert("You must provide a device alias")}}},ht=Qt();function en(e){let t;return{c(){t=h("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){M(n,t,o)},d(n){n&&D(t)}}}function tn(e){let t;return{c(){t=h("h1"),t.textContent="Waiting for device alias..."},m(n,o){M(n,t,o)},i:N,o:N,d(n){n&&D(t)}}}function nn(e){let t,n;return t=new Gt({}),{c(){yt(t.$$.fragment)},m(o,s){Le(t,o,s),n=!0},i(o){n||(oe(t.$$.fragment,o),n=!0)},o(o){_e(t.$$.fragment,o),n=!1},d(o){Be(t,o)}}}function on(e){let t,n,o,s,i,c,u,m,r,S;o=new Rt({});let l=!e[1]&&en();const v=[nn,tn],_=[];function w(f,F){return f[0]?0:1}return u=w(e),m=_[u]=v[u](e),{c(){t=h("meta"),n=C(),yt(o.$$.fragment),s=C(),i=h("main"),l&&l.c(),c=C(),m.c(),r=Dt(),g(t,"name","viewport"),g(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(f,F){a(document.head,t),M(f,n,F),Le(o,f,F),M(f,s,F),M(f,i,F),l&&l.m(i,null),M(f,c,F),_[u].m(f,F),M(f,r,F),S=!0},p(f,[F]){let O=u;u=w(f),u!==O&&(At(),_e(_[O],1,1,()=>{_[O]=null}),Lt(),m=_[u],m||(m=_[u]=v[u](f),m.c()),oe(m,1),m.m(r.parentNode,r))},i(f){S||(oe(o.$$.fragment,f),oe(m),S=!0)},o(f){_e(o.$$.fragment,f),_e(m),S=!1},d(f){f&&(D(n),D(s),D(i),D(c),D(r)),D(t),Be(o,f),l&&l.d(),_[u].d(f)}}}function sn(e,t,n){let o;Ae(e,ht,i=>n(0,o=i));const s=typeof BarcodeDetector<"u";return ht.ask(),[o,s]}class cn extends xe{constructor(t){super(),je(this,t,sn,on,ve,{})}}new cn({target:document.getElementById("app")});
