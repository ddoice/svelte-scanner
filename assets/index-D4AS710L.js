var ye=Object.defineProperty;var $e=(e,t,n)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Z=(e,t,n)=>($e(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function w(){}function ge(e){return e()}function ae(){return Object.create(null)}function V(e){e.forEach(ge)}function _e(e){return typeof e=="function"}function K(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function we(e){return Object.keys(e).length===0}function Se(e,...t){if(e==null){for(const o of t)o(void 0);return w}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function ee(e,t,n){e.$$.on_destroy.push(Se(t,n))}function ue(e){return e??""}function h(e,t){e.appendChild(t)}function C(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode&&e.parentNode.removeChild(e)}function xe(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function $(e){return document.createElement(e)}function k(e){return document.createTextNode(e)}function N(){return k(" ")}function Ce(){return k("")}function ke(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function I(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Fe(e){return Array.from(e.childNodes)}function j(e,t){t=""+t,e.data!==t&&(e.data=t)}let q;function z(e){q=e}function Ie(){if(!q)throw new Error("Function called outside component initialization");return q}function Ne(e){Ie().$$.on_mount.push(e)}const A=[],Y=[];let E=[];const le=[],Oe=Promise.resolve();let G=!1;function Te(){G||(G=!0,Oe.then(ve))}function Q(e){E.push(e)}const W=new Set;let D=0;function ve(){if(D!==0)return;const e=q;do{try{for(;D<A.length;){const t=A[D];D++,z(t),De(t.$$)}}catch(t){throw A.length=0,D=0,t}for(z(null),A.length=0,D=0;Y.length;)Y.pop()();for(let t=0;t<E.length;t+=1){const n=E[t];W.has(n)||(W.add(n),n())}E.length=0}while(A.length);for(;le.length;)le.pop()();G=!1,W.clear(),z(e)}function De(e){if(e.fragment!==null){e.update(),V(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Q)}}function Pe(e){const t=[],n=[];E.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),E=t}const H=new Set;let O;function Ae(){O={r:0,c:[],p:O}}function Ee(){O.r||V(O.c),O=O.p}function U(e,t){e&&e.i&&(H.delete(e),e.i(t))}function J(e,t,n,o){if(e&&e.o){if(H.has(e))return;H.add(e),O.c.push(()=>{H.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function fe(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function be(e){e&&e.c()}function te(e,t,n){const{fragment:o,after_update:i}=e.$$;o&&o.m(t,n),Q(()=>{const r=e.$$.on_mount.map(ge).filter(_e);e.$$.on_destroy?e.$$.on_destroy.push(...r):V(r),e.$$.on_mount=[]}),i.forEach(Q)}function ne(e,t){const n=e.$$;n.fragment!==null&&(Pe(n.after_update),V(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Me(e,t){e.$$.dirty[0]===-1&&(A.push(e),Te(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function oe(e,t,n,o,i,r,c=null,a=[-1]){const l=q;z(e);const s=e.$$={fragment:null,ctx:[],props:r,update:w,not_equal:i,bound:ae(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:ae(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};c&&c(s.root);let u=!1;if(s.ctx=n?n(e,t.props||{},(d,_,...g)=>{const S=g.length?g[0]:_;return s.ctx&&i(s.ctx[d],s.ctx[d]=S)&&(!s.skip_bound&&s.bound[d]&&s.bound[d](S),u&&Me(e,d)),_}):[],s.update(),u=!0,V(s.before_update),s.fragment=o?o(s.ctx):!1,t.target){if(t.hydrate){const d=Fe(t.target);s.fragment&&s.fragment.l(d),d.forEach(y)}else s.fragment&&s.fragment.c();t.intro&&U(e.$$.fragment),te(e,t.target,t.anchor),ve()}z(l)}class ie{constructor(){Z(this,"$$");Z(this,"$$set")}$destroy(){ne(this,1),this.$destroy=w}$on(t,n){if(!_e(n))return w;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const i=o.indexOf(n);i!==-1&&o.splice(i,1)}}$set(t){this.$$set&&!we(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Le="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Le);const P=[];function re(e,t=w){let n;const o=new Set;function i(a){if(K(e,a)&&(e=a,n)){const l=!P.length;for(const s of o)s[1](),P.push(s,e);if(l){for(let s=0;s<P.length;s+=2)P[s][0](P[s+1]);P.length=0}}}function r(a){i(a(e))}function c(a,l=w){const s=[a,l];return o.add(s),o.size===1&&(n=t(i,r)||w),a(e),()=>{o.delete(s),o.size===0&&n&&(n(),n=null)}}return{set:i,update:r,subscribe:c}}let de=0;const Be=5e9;function je(){const{subscribe:e,update:t}=re([]);function n(i){de+=1;const r=de,c={...i,id:r};t(a=>[...a,c]),setTimeout(()=>{o(r)},Be)}function o(i){t(r=>r.filter(c=>c.id!==i))}return{subscribe:e,addNotification:n,closeNotification:o}}const R=je();function pe(e,t,n){const o=e.slice();return o[2]=t[n],o}function me(e){let t,n,o=e[2].text+"",i,r,c,a,l,s,u;function d(){return e[1](e[2])}return{c(){t=$("div"),n=$("div"),i=k(o),r=N(),c=$("button"),c.textContent="X",a=N(),I(c,"class","svelte-1mipv5u"),I(t,"class",l=ue(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(_,g){C(_,t,g),h(t,n),h(n,i),h(t,r),h(t,c),h(t,a),s||(u=ke(c,"click",d),s=!0)},p(_,g){e=_,g&1&&o!==(o=e[2].text+"")&&j(i,o),g&1&&l!==(l=ue(`notification ${e[2].type}`)+" svelte-1mipv5u")&&I(t,"class",l)},d(_){_&&y(t),s=!1,u()}}}function ze(e){let t,n=fe(e[0]),o=[];for(let i=0;i<n.length;i+=1)o[i]=me(pe(e,n,i));return{c(){t=$("div");for(let i=0;i<o.length;i+=1)o[i].c();I(t,"id","notifications-container"),I(t,"class","svelte-1mipv5u")},m(i,r){C(i,t,r);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(t,null)},p(i,[r]){if(r&1){n=fe(i[0]);let c;for(c=0;c<n.length;c+=1){const a=pe(i,n,c);o[c]?o[c].p(a,r):(o[c]=me(a),o[c].c(),o[c].m(t,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=n.length}},i:w,o:w,d(i){i&&y(t),xe(o,i)}}}function Ue(e,t,n){let o;return ee(e,R,r=>n(0,o=r)),[o,r=>R.closeNotification(r.id)]}class qe extends ie{constructor(t){super(),oe(this,t,Ue,ze,K,{})}}const Re="https://yup.perfdive.com/api",se=async(e,t)=>{const n=await fetch(`${Re}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},Ve=async e=>{try{return await se("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),R.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},He=async e=>{try{return await se("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),R.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},Je=async e=>{const t=new FormData;t.append("photo",e);try{const n=await se("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),R.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},Ke=e=>{const t=e.getCapabilities(),n=e.getSettings();return Ve(t),He(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:u}=t;return u&&(u.max-u.min)/u.step,u},getSettings:()=>e.getSettings(),setFocusMode:u=>e.applyConstraints({advanced:[{focusMode:u}]}),setFocusDistance:u=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:u}]}),setTorch:u=>{t.torch&&e.applyConstraints({advanced:[{torch:u}]})},settings:n,setZoom:u=>e.applyConstraints({advanced:[{zoom:u}]})}};function Ze(){let e=["grabFrame","videoCapture","takePhoto"],t="grabFrame",n=0,o=0,i=0,r=0,c=0,a,l=!1,s=null,u,d,_;function g(f,p,x,ce){_=f,u=new ImageCapture(p),d=new BarcodeDetector({formats:["pdf417"]})}async function S(){if(t==="grabFrame")return u.grabFrame();if(t==="videoCapture")return _;if(t==="takePhoto"){const f=await u.takePhoto(),p=new Image;return p.src=URL.createObjectURL(f),await new Promise(x=>{p.onload=x}),p}}async function m(){const f=await S();return await d.detect(f)}async function b(){const f=await u.grabFrame(),p=document.createElement("canvas"),x=p.getContext("2d");p.width=f.width,p.height=f.height,x.drawImage(f,0,0),p.toBlob(ce=>{Je(ce)})}function F(f){const p=Date.now()-f;r+=1,c=r>1?(c*(r-1)+p)/r:p,v(x=>({...x,scanCount:r,average:c}))}async function M(){try{const f=Date.now(),p=await m();if(l)return;F(f),p.length>0?(n+=1,s=p[0].rawValue,v(x=>({...x,barcode:s,success:n}))):(o+=1,v(x=>({...x,fail:o})))}catch(f){i+=1,v(p=>({...p,error:i})),console.log(f)}finally{setTimeout(M,100)}}function T(){l=!0}function L(){l=!0,clearInterval(a),T()}const{subscribe:B,update:v}=re({mode:t,success:n,fail:o,barcode:s,scanCount:r,error:i,average:c,toggleMode:()=>{const p=(e.indexOf(t)+1)%e.length;t=e[p],v(x=>({...x,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{s=null}});return{init:g,subscribe:B,toggleMode:()=>v(f=>({...f,mode:e[(e.indexOf(f.mode)+1)%e.length]})),resetStats:()=>v(f=>({...f,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>v(f=>({...f,barcode:null})),stop:L,start:()=>{M(),a=setInterval(b,5e3)}}}function We(e){let t,n,o,i=e[1].scanCount+"",r,c,a,l,s=e[1].average.toFixed(2)+"",u,d,_,g,S=e[1].fail+"",m,b,F,M,T=e[1].success+"",L,B,v;return{c(){t=$("div"),n=$("div"),o=k("Scan count: "),r=k(i),c=N(),a=$("div"),l=k("Average: "),u=k(s),d=N(),_=$("div"),g=k("Fail: "),m=k(S),b=N(),F=$("div"),M=k("Success: "),L=k(T),B=N(),v=$("video"),v.innerHTML="",I(t,"class","stats svelte-17zzhxa"),v.autoplay=!0,I(v,"id","stream"),I(v,"class","svelte-17zzhxa")},m(f,p){C(f,t,p),h(t,n),h(n,o),h(n,r),h(t,c),h(t,a),h(a,l),h(a,u),h(t,d),h(t,_),h(_,g),h(_,m),h(t,b),h(t,F),h(F,M),h(F,L),C(f,B,p),C(f,v,p),e[3](v)},p(f,[p]){p&2&&i!==(i=f[1].scanCount+"")&&j(r,i),p&2&&s!==(s=f[1].average.toFixed(2)+"")&&j(u,s),p&2&&S!==(S=f[1].fail+"")&&j(m,S),p&2&&T!==(T=f[1].success+"")&&j(L,T)},i:w,o:w,d(f){f&&(y(t),y(B),y(v)),e[3](null)}}}function Xe(e,t,n){let o;const i=()=>navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:960},height:{ideal:1280}},audio:!1});let r,c,a,l,s=Ze();ee(e,s,d=>n(1,o=d)),Ne(()=>((async()=>{try{c=await i(),n(0,r.srcObject=c,r),a=c.getVideoTracks()[0],l=Ke(a),s.init(r,a,r.width,r.height),s.start()}catch(d){console.log("error",d),alert("Could not access the camera")}})(),()=>s==null?void 0:s.stop()));function u(d){Y[d?"unshift":"push"](()=>{r=d,n(0,r)})}return[r,o,s,u]}class Ye extends ie{constructor(t){super(),oe(this,t,Xe,We,K,{})}}const X="deviceAlias",Ge=()=>{const{subscribe:e,set:t}=re(localStorage.getItem(X));return{subscribe:e,ask:()=>{if(localStorage.getItem(X))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(X,n),t(n)):alert("You must provide a device alias")}}},he=Ge();function Qe(e){let t;return{c(){t=$("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){C(n,t,o)},d(n){n&&y(t)}}}function et(e){let t;return{c(){t=$("h1"),t.textContent="Waiting for device alias..."},m(n,o){C(n,t,o)},i:w,o:w,d(n){n&&y(t)}}}function tt(e){let t,n;return t=new Ye({}),{c(){be(t.$$.fragment)},m(o,i){te(t,o,i),n=!0},i(o){n||(U(t.$$.fragment,o),n=!0)},o(o){J(t.$$.fragment,o),n=!1},d(o){ne(t,o)}}}function nt(e){let t,n,o,i,r,c,a,l,s,u;o=new qe({});let d=!e[1]&&Qe();const _=[tt,et],g=[];function S(m,b){return m[0]?0:1}return a=S(e),l=g[a]=_[a](e),{c(){t=$("meta"),n=N(),be(o.$$.fragment),i=N(),r=$("main"),d&&d.c(),c=N(),l.c(),s=Ce(),I(t,"name","viewport"),I(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(m,b){h(document.head,t),C(m,n,b),te(o,m,b),C(m,i,b),C(m,r,b),d&&d.m(r,null),C(m,c,b),g[a].m(m,b),C(m,s,b),u=!0},p(m,[b]){let F=a;a=S(m),a!==F&&(Ae(),J(g[F],1,1,()=>{g[F]=null}),Ee(),l=g[a],l||(l=g[a]=_[a](m),l.c()),U(l,1),l.m(s.parentNode,s))},i(m){u||(U(o.$$.fragment,m),U(l),u=!0)},o(m){J(o.$$.fragment,m),J(l),u=!1},d(m){m&&(y(n),y(i),y(r),y(c),y(s)),y(t),ne(o,m),d&&d.d(),g[a].d(m)}}}function ot(e,t,n){let o;ee(e,he,r=>n(0,o=r));const i=typeof BarcodeDetector<"u";return he.ask(),[o,i]}class it extends ie{constructor(t){super(),oe(this,t,ot,nt,K,{})}}new it({target:document.getElementById("app")});
