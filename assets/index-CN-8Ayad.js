var Be=Object.defineProperty;var je=(e,t,n)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ae=(e,t,n)=>(je(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function T(){}function xe(e){return e()}function Fe(){return Object.create(null)}function V(e){e.forEach(xe)}function Ae(e){return typeof e=="function"}function se(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let te;function De(e,t){return e===t?!0:(te||(te=document.createElement("a")),te.href=t,e===te.href)}function ze(e){return Object.keys(e).length===0}function Ue(e,...t){if(e==null){for(const o of t)o(void 0);return T}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function me(e,t,n){e.$$.on_destroy.push(Ue(t,n))}function Oe(e){return e??""}function d(e,t){e.appendChild(t)}function P(e,t,n){e.insertBefore(t,n||null)}function D(e){e.parentNode&&e.parentNode.removeChild(e)}function Re(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function y(e){return document.createElement(e)}function I(e){return document.createTextNode(e)}function N(){return I(" ")}function Ve(){return I("")}function J(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function v(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ze(e){return e===""?null:+e}function He(e){return Array.from(e.childNodes)}function q(e,t){t=""+t,e.data!==t&&(e.data=t)}function ke(e,t){e.value=t??""}let X;function K(e){X=e}function Je(){if(!X)throw new Error("Function called outside component initialization");return X}function Ke(e){Je().$$.on_mount.push(e)}const U=[],fe=[];let R=[];const Pe=[],We=Promise.resolve();let de=!1;function Xe(){de||(de=!0,We.then(qe))}function pe(e){R.push(e)}const ue=new Set;let j=0;function qe(){if(j!==0)return;const e=X;do{try{for(;j<U.length;){const t=U[j];j++,K(t),Ye(t.$$)}}catch(t){throw U.length=0,j=0,t}for(K(null),U.length=0,j=0;fe.length;)fe.pop()();for(let t=0;t<R.length;t+=1){const n=R[t];ue.has(n)||(ue.add(n),n())}R.length=0}while(U.length);for(;Pe.length;)Pe.pop()();de=!1,ue.clear(),K(e)}function Ye(e){if(e.fragment!==null){e.update(),V(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(pe)}}function Ge(e){const t=[],n=[];R.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),R=t}const ne=new Set;let L;function Qe(){L={r:0,c:[],p:L}}function et(){L.r||V(L.c),L=L.p}function W(e,t){e&&e.i&&(ne.delete(e),e.i(t))}function oe(e,t,n,o){if(e&&e.o){if(ne.has(e))return;ne.add(e),L.c.push(()=>{ne.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function Ie(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Le(e){e&&e.c()}function ge(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),pe(()=>{const i=e.$$.on_mount.map(xe).filter(Ae);e.$$.on_destroy?e.$$.on_destroy.push(...i):V(i),e.$$.on_mount=[]}),s.forEach(pe)}function he(e,t){const n=e.$$;n.fragment!==null&&(Ge(n.after_update),V(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function tt(e,t){e.$$.dirty[0]===-1&&(U.push(e),Xe(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function _e(e,t,n,o,s,i,c=null,l=[-1]){const u=X;K(e);const r=e.$$={fragment:null,ctx:[],props:i,update:T,not_equal:s,bound:Fe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:Fe(),dirty:l,skip_bound:!1,root:t.target||u.$$.root};c&&c(r.root);let _=!1;if(r.ctx=n?n(e,t.props||{},(a,f,...g)=>{const b=g.length?g[0]:f;return r.ctx&&s(r.ctx[a],r.ctx[a]=b)&&(!r.skip_bound&&r.bound[a]&&r.bound[a](b),_&&tt(e,a)),f}):[],r.update(),_=!0,V(r.before_update),r.fragment=o?o(r.ctx):!1,t.target){if(t.hydrate){const a=He(t.target);r.fragment&&r.fragment.l(a),a.forEach(D)}else r.fragment&&r.fragment.c();t.intro&&W(e.$$.fragment),ge(e,t.target,t.anchor),qe()}K(u)}class ve{constructor(){ae(this,"$$");ae(this,"$$set")}$destroy(){he(this,1),this.$destroy=T}$on(t,n){if(!Ae(n))return T;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!ze(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const nt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nt);const z=[];function be(e,t=T){let n;const o=new Set;function s(l){if(se(e,l)&&(e=l,n)){const u=!z.length;for(const r of o)r[1](),z.push(r,e);if(u){for(let r=0;r<z.length;r+=2)z[r][0](z[r+1]);z.length=0}}}function i(l){s(l(e))}function c(l,u=T){const r=[l,u];return o.add(r),o.size===1&&(n=t(s,i)||T),l(e),()=>{o.delete(r),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:c}}let Ne=0;const ot=3e3;function st(){const{subscribe:e,update:t}=be([]);function n(s){Ne+=1;const i=Ne,c={...s,id:i};t(l=>[...l,c].slice(-5)),setTimeout(()=>{o(i)},ot)}function o(s){t(i=>i.filter(c=>c.id!==s))}return{subscribe:e,addNotification:n,closeNotification:o}}const Y=st();function Te(e,t,n){const o=e.slice();return o[2]=t[n],o}function Me(e){let t,n,o=e[2].text+"",s,i,c,l,u,r,_;function a(){return e[1](e[2])}return{c(){t=y("div"),n=y("div"),s=I(o),i=N(),c=y("button"),c.textContent="X",l=N(),v(c,"class","svelte-1mipv5u"),v(t,"class",u=Oe(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(f,g){P(f,t,g),d(t,n),d(n,s),d(t,i),d(t,c),d(t,l),r||(_=J(c,"click",a),r=!0)},p(f,g){e=f,g&1&&o!==(o=e[2].text+"")&&q(s,o),g&1&&u!==(u=Oe(`notification ${e[2].type}`)+" svelte-1mipv5u")&&v(t,"class",u)},d(f){f&&D(t),r=!1,_()}}}function it(e){let t,n=Ie(e[0]),o=[];for(let s=0;s<n.length;s+=1)o[s]=Me(Te(e,n,s));return{c(){t=y("div");for(let s=0;s<o.length;s+=1)o[s].c();v(t,"id","notifications-container"),v(t,"class","svelte-1mipv5u")},m(s,i){P(s,t,i);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(t,null)},p(s,[i]){if(i&1){n=Ie(s[0]);let c;for(c=0;c<n.length;c+=1){const l=Te(s,n,c);o[c]?o[c].p(l,i):(o[c]=Me(l),o[c].c(),o[c].m(t,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=n.length}},i:T,o:T,d(s){s&&D(t),Re(o,s)}}}function rt(e,t,n){let o;return me(e,Y,i=>n(0,o=i)),[o,i=>Y.closeNotification(i.id)]}class ct extends ve{constructor(t){super(),_e(this,t,rt,it,se,{})}}const at="https://yup.perfdive.com/api",ye=async(e,t)=>{const n=await fetch(`${at}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},ut=async e=>{try{return await ye("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),Y.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},lt=async e=>{try{return await ye("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),Y.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},ft=async e=>{const t=new FormData;t.append("photo",e);try{const n=await ye("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),Y.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},dt=e=>{const t=e.getCapabilities(),n=e.getSettings();return ut(t),lt(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:a}=t;return a&&(a.max-a.min)/a.step,a},getSettings:()=>e.getSettings(),setFocusMode:a=>e.applyConstraints({advanced:[{focusMode:a}]}),setFocusDistance:a=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}),setTorch:a=>{t.torch&&e.applyConstraints({advanced:[{torch:a}]})},settings:n,setFocusDistancePct:async a=>{const{focusDistance:f}=t;if(!f){alert("Focus distance not supported");return}const g=f.min+(f.max-f.min)*a;try{await e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:g}]})}catch(b){alert(b.message),console.error(b)}return g},setZoom:a=>e.applyConstraints({advanced:[{zoom:a}]})}};function pt(){const e=["grabFrame","videoCapture","takePhoto"];let t="grabFrame",n=0,o=0,s=0,i=0,c=0,l,u=!1,r=null,_,a,f;function g(h,p,w,x){f=h,_=new ImageCapture(p),a=new BarcodeDetector({formats:["pdf417"]})}async function b(){if(t==="grabFrame")return _.grabFrame();if(t==="videoCapture")return f;if(t==="takePhoto"){const h=await _.takePhoto(),p=new Image;return p.src=URL.createObjectURL(h),await new Promise(w=>{p.onload=w}),p}}async function m(){const h=await b();return await a.detect(h)}async function F(){const h=await _.grabFrame(),p=document.createElement("canvas"),w=p.getContext("2d");p.width=h.width,p.height=h.height,w.drawImage(h,0,0),p.toBlob(x=>{ft(x)})}function M(h){const p=Date.now()-h;i+=1,c=i>1?(c*(i-1)+p)/i:p,C(w=>({...w,scanCount:i,average:c}))}async function S(){try{const h=Date.now(),p=await m();if(u)return;M(h),p.length>0?(n+=1,r=p[0].rawValue,C(w=>({...w,barcode:r,success:n}))):(o+=1,C(w=>({...w,fail:o})))}catch(h){s+=1,C(p=>({...p,error:s})),console.log(h)}finally{setTimeout(S,100)}}function E(){u=!0}function Z(){u=!0,clearInterval(l),E()}const{subscribe:H,update:C}=be({mode:t,success:n,fail:o,barcode:r,scanCount:i,error:s,average:c,toggleMode:()=>{const p=(e.indexOf(t)+1)%e.length;t=e[p],C(w=>({...w,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{r=null}});return{init:g,subscribe:H,toggleMode:()=>C(h=>({...h,mode:e[(e.indexOf(h.mode)+1)%e.length]})),resetStats:()=>C(h=>({...h,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>C(h=>({...h,barcode:null})),stop:Z,start:()=>{S(),l=setInterval(F,5e3)}}}function mt(e){let t,n,o,s=e[4].scanCount+"",i,c,l,u,r=e[4].average.toFixed(2)+"",_,a,f,g,b=e[4].fail+"",m,F,M,S,E=e[4].success+"",Z,H,C,h,p,w,x,A,G,we,ie,$e,B,k,Q,Se,ee=(e[1]?e[1]:"-")+"",re,ce,Ce;return{c(){t=y("div"),n=y("div"),o=I("Scan count: "),i=I(s),c=N(),l=y("div"),u=I("Average: "),_=I(r),a=N(),f=y("div"),g=I("Fail: "),m=I(b),F=N(),M=y("div"),S=I("Success: "),Z=I(E),H=N(),C=y("video"),C.innerHTML="",h=N(),p=y("div"),w=y("div"),x=y("button"),A=y("img"),we=N(),ie=I(e[3]),$e=N(),B=y("div"),k=y("input"),Se=N(),re=I(ee),v(t,"class","stats svelte-1t7abqf"),C.autoplay=!0,v(C,"id","stream"),v(C,"class","svelte-1t7abqf"),De(A.src,G=`public/${e[3]}-focus.svg`)||v(A,"src",G),v(A,"class","svelte-1t7abqf"),v(w,"class","focus__button svelte-1t7abqf"),k.disabled=Q=e[3]==="continuous",v(k,"id","zoom__range"),v(k,"type","range"),v(k,"min","0"),v(k,"max","100"),v(k,"class","svelte-1t7abqf"),v(B,"class","focus__button grow svelte-1t7abqf"),v(p,"id","focus"),v(p,"class","svelte-1t7abqf")},m($,O){P($,t,O),d(t,n),d(n,o),d(n,i),d(t,c),d(t,l),d(l,u),d(l,_),d(t,a),d(t,f),d(f,g),d(f,m),d(t,F),d(t,M),d(M,S),d(M,Z),P($,H,O),P($,C,O),e[8](C),P($,h,O),P($,p,O),d(p,w),d(w,x),d(x,A),d(w,we),d(w,ie),d(p,$e),d(p,B),d(B,k),ke(k,e[0]),d(B,Se),d(B,re),ce||(Ce=[J(x,"click",e[7]),J(k,"change",e[9]),J(k,"input",e[9]),J(k,"change",e[5])],ce=!0)},p($,[O]){O&16&&s!==(s=$[4].scanCount+"")&&q(i,s),O&16&&r!==(r=$[4].average.toFixed(2)+"")&&q(_,r),O&16&&b!==(b=$[4].fail+"")&&q(m,b),O&16&&E!==(E=$[4].success+"")&&q(Z,E),O&8&&!De(A.src,G=`public/${$[3]}-focus.svg`)&&v(A,"src",G),O&8&&q(ie,$[3]),O&8&&Q!==(Q=$[3]==="continuous")&&(k.disabled=Q),O&1&&ke(k,$[0]),O&2&&ee!==(ee=($[1]?$[1]:"-")+"")&&q(re,ee)},i:T,o:T,d($){$&&(D(t),D(H),D(C),D(h),D(p)),e[8](null),ce=!1,V(Ce)}}}function gt(e,t,n){let o,s=0,i;async function c(S){console.log(S.target.value),n(0,s=S.target.value);const E=await(a==null?void 0:a.setFocusDistancePct(s));n(1,i=E||void 0)}const l=()=>navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:960},height:{ideal:1280}},audio:!1});let u,r,_,a,f=pt();me(e,f,S=>n(4,o=S));const g=["continuous","manual"];let b="continuous";const m=async()=>{const S=g[g.indexOf(b)+1]||g[0];try{await a.setFocusMode(b),n(3,b=S)}catch{alert("Could not set focus mode")}};Ke(()=>((async()=>{try{r=await l(),n(2,u.srcObject=r,u),_=r.getVideoTracks()[0],a=dt(_),f.init(u,_,u.width,u.height),f.start()}catch(S){console.log("error",S),alert("Could not access the camera")}})(),()=>f==null?void 0:f.stop()));function F(S){fe[S?"unshift":"push"](()=>{u=S,n(2,u)})}function M(){s=Ze(this.value),n(0,s)}return[s,i,u,b,o,c,f,m,F,M]}class ht extends ve{constructor(t){super(),_e(this,t,gt,mt,se,{})}}const le="deviceAlias",_t=()=>{const{subscribe:e,set:t}=be(localStorage.getItem(le));return{subscribe:e,ask:()=>{if(localStorage.getItem(le))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(le,n),t(n)):alert("You must provide a device alias")}}},Ee=_t();function vt(e){let t;return{c(){t=y("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){P(n,t,o)},d(n){n&&D(t)}}}function bt(e){let t;return{c(){t=y("h1"),t.textContent="Waiting for device alias..."},m(n,o){P(n,t,o)},i:T,o:T,d(n){n&&D(t)}}}function yt(e){let t,n;return t=new ht({}),{c(){Le(t.$$.fragment)},m(o,s){ge(t,o,s),n=!0},i(o){n||(W(t.$$.fragment,o),n=!0)},o(o){oe(t.$$.fragment,o),n=!1},d(o){he(t,o)}}}function wt(e){let t,n,o,s,i,c,l,u,r,_;o=new ct({});let a=!e[1]&&vt();const f=[yt,bt],g=[];function b(m,F){return m[0]?0:1}return l=b(e),u=g[l]=f[l](e),{c(){t=y("meta"),n=N(),Le(o.$$.fragment),s=N(),i=y("main"),a&&a.c(),c=N(),u.c(),r=Ve(),v(t,"name","viewport"),v(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(m,F){d(document.head,t),P(m,n,F),ge(o,m,F),P(m,s,F),P(m,i,F),a&&a.m(i,null),P(m,c,F),g[l].m(m,F),P(m,r,F),_=!0},p(m,[F]){let M=l;l=b(m),l!==M&&(Qe(),oe(g[M],1,1,()=>{g[M]=null}),et(),u=g[l],u||(u=g[l]=f[l](m),u.c()),W(u,1),u.m(r.parentNode,r))},i(m){_||(W(o.$$.fragment,m),W(u),_=!0)},o(m){oe(o.$$.fragment,m),oe(u),_=!1},d(m){m&&(D(n),D(s),D(i),D(c),D(r)),D(t),he(o,m),a&&a.d(),g[l].d(m)}}}function $t(e,t,n){let o;me(e,Ee,i=>n(0,o=i));const s=typeof BarcodeDetector<"u";return Ee.ask(),[o,s]}class St extends ve{constructor(t){super(),_e(this,t,$t,wt,se,{})}}new St({target:document.getElementById("app")});
