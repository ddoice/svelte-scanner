var rt=Object.defineProperty;var at=(e,t,n)=>t in e?rt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var he=(e,t,n)=>(at(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function T(){}function ot(e){return e()}function Je(){return Object.create(null)}function Z(e){e.forEach(ot)}function st(e){return typeof e=="function"}function re(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let se;function Ke(e,t){return e===t?!0:(se||(se=document.createElement("a")),se.href=t,e===se.href)}function ut(e){return Object.keys(e).length===0}function lt(e,...t){if(e==null){for(const o of t)o(void 0);return T}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function $e(e,t,n){e.$$.on_destroy.push(lt(t,n))}function We(e){return e??""}function f(e,t){e.appendChild(t)}function N(e,t,n){e.insertBefore(t,n||null)}function O(e){e.parentNode&&e.parentNode.removeChild(e)}function ft(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function b(e){return document.createElement(e)}function k(e){return document.createTextNode(e)}function P(){return k(" ")}function dt(){return k("")}function K(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function v(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function pt(e){return e===""?null:+e}function mt(e){return Array.from(e.childNodes)}function E(e,t){t=""+t,e.data!==t&&(e.data=t)}function Xe(e,t){e.value=t??""}let Y;function W(e){Y=e}function gt(){if(!Y)throw new Error("Function called outside component initialization");return Y}function ht(e){gt().$$.on_mount.push(e)}const R=[],be=[];let V=[];const Ye=[],_t=Promise.resolve();let ye=!1;function vt(){ye||(ye=!0,_t.then(it))}function we(e){V.push(e)}const _e=new Set;let z=0;function it(){if(z!==0)return;const e=Y;do{try{for(;z<R.length;){const t=R[z];z++,W(t),bt(t.$$)}}catch(t){throw R.length=0,z=0,t}for(W(null),R.length=0,z=0;be.length;)be.pop()();for(let t=0;t<V.length;t+=1){const n=V[t];_e.has(n)||(_e.add(n),n())}V.length=0}while(R.length);for(;Ye.length;)Ye.pop()();ye=!1,_e.clear(),W(e)}function bt(e){if(e.fragment!==null){e.update(),Z(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(we)}}function yt(e){const t=[],n=[];V.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),V=t}const ie=new Set;let j;function wt(){j={r:0,c:[],p:j}}function $t(){j.r||Z(j.c),j=j.p}function X(e,t){e&&e.i&&(ie.delete(e),e.i(t))}function ce(e,t,n,o){if(e&&e.o){if(ie.has(e))return;ie.add(e),j.c.push(()=>{ie.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function Ge(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function ct(e){e&&e.c()}function Se(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),we(()=>{const i=e.$$.on_mount.map(ot).filter(st);e.$$.on_destroy?e.$$.on_destroy.push(...i):Z(i),e.$$.on_mount=[]}),s.forEach(we)}function Fe(e,t){const n=e.$$;n.fragment!==null&&(yt(n.after_update),Z(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function St(e,t){e.$$.dirty[0]===-1&&(R.push(e),vt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ce(e,t,n,o,s,i,r=null,l=[-1]){const u=Y;W(e);const c=e.$$={fragment:null,ctx:[],props:i,update:T,not_equal:s,bound:Je(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:Je(),dirty:l,skip_bound:!1,root:t.target||u.$$.root};r&&r(c.root);let _=!1;if(c.ctx=n?n(e,t.props||{},(a,d,...h)=>{const y=h.length?h[0]:d;return c.ctx&&s(c.ctx[a],c.ctx[a]=y)&&(!c.skip_bound&&c.bound[a]&&c.bound[a](y),_&&St(e,a)),d}):[],c.update(),_=!0,Z(c.before_update),c.fragment=o?o(c.ctx):!1,t.target){if(t.hydrate){const a=mt(t.target);c.fragment&&c.fragment.l(a),a.forEach(O)}else c.fragment&&c.fragment.c();t.intro&&X(e.$$.fragment),Se(e,t.target,t.anchor),it()}W(u)}class De{constructor(){he(this,"$$");he(this,"$$set")}$destroy(){Fe(this,1),this.$destroy=T}$on(t,n){if(!st(n))return T;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!ut(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ft="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ft);const U=[];function Oe(e,t=T){let n;const o=new Set;function s(l){if(re(e,l)&&(e=l,n)){const u=!U.length;for(const c of o)c[1](),U.push(c,e);if(u){for(let c=0;c<U.length;c+=2)U[c][0](U[c+1]);U.length=0}}}function i(l){s(l(e))}function r(l,u=T){const c=[l,u];return o.add(c),o.size===1&&(n=t(s,i)||T),l(e),()=>{o.delete(c),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:r}}let Qe=0;const Ct=3e3;function Dt(){const{subscribe:e,update:t}=Oe([]);function n(s){Qe+=1;const i=Qe,r={...s,id:i};t(l=>[...l,r].slice(-5)),setTimeout(()=>{o(i)},Ct)}function o(s){t(i=>i.filter(r=>r.id!==s))}return{subscribe:e,addNotification:n,closeNotification:o}}const G=Dt();function et(e,t,n){const o=e.slice();return o[2]=t[n],o}function tt(e){let t,n,o=e[2].text+"",s,i,r,l,u,c,_;function a(){return e[1](e[2])}return{c(){t=b("div"),n=b("div"),s=k(o),i=P(),r=b("button"),r.textContent="X",l=P(),v(r,"class","svelte-1mipv5u"),v(t,"class",u=We(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(d,h){N(d,t,h),f(t,n),f(n,s),f(t,i),f(t,r),f(t,l),c||(_=K(r,"click",a),c=!0)},p(d,h){e=d,h&1&&o!==(o=e[2].text+"")&&E(s,o),h&1&&u!==(u=We(`notification ${e[2].type}`)+" svelte-1mipv5u")&&v(t,"class",u)},d(d){d&&O(t),c=!1,_()}}}function Ot(e){let t,n=Ge(e[0]),o=[];for(let s=0;s<n.length;s+=1)o[s]=tt(et(e,n,s));return{c(){t=b("div");for(let s=0;s<o.length;s+=1)o[s].c();v(t,"id","notifications-container"),v(t,"class","svelte-1mipv5u")},m(s,i){N(s,t,i);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(t,null)},p(s,[i]){if(i&1){n=Ge(s[0]);let r;for(r=0;r<n.length;r+=1){const l=et(s,n,r);o[r]?o[r].p(l,i):(o[r]=tt(l),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},i:T,o:T,d(s){s&&O(t),ft(o,s)}}}function kt(e,t,n){let o;return $e(e,G,i=>n(0,o=i)),[o,i=>G.closeNotification(i.id)]}class Pt extends De{constructor(t){super(),Ce(this,t,kt,Ot,re,{})}}const It="https://yup.perfdive.com/api",ke=async(e,t)=>{const n=await fetch(`${It}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},Nt=async e=>{try{return await ke("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),G.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},Tt=async e=>{try{return await ke("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),G.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},xt=async e=>{const t=new FormData;t.append("photo",e);try{const n=await ke("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),G.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},Mt=e=>{const t=e.getCapabilities(),n=e.getSettings();return Nt(t),Tt(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:a}=t;return a&&(a.max-a.min)/a.step,a},getSettings:()=>e.getSettings(),setFocusMode:a=>e.applyConstraints({advanced:[{focusMode:a}]}),setFocusDistance:a=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}),setTorch:a=>{t.torch&&e.applyConstraints({advanced:[{torch:a}]})},settings:n,setFocusDistancePct:async a=>{const{focusDistance:d}=t;if(!d){alert("Focus distance not supported");return}const h=(d.max-d.min)/100,y=d.min+h*a;try{await e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:y}]})}catch(p){alert(p.message),console.error(p)}return y},setZoom:a=>e.applyConstraints({advanced:[{zoom:a}]})}};function Et(){const e=["grabFrame","videoCapture","takePhoto"];let t="grabFrame",n=0,o=0,s=0,i=0,r=0,l,u=!1,c=null,_,a,d;function h(g,m,$,A){d=g,_=new ImageCapture(m),a=new BarcodeDetector({formats:["pdf417"]})}async function y(){if(t==="grabFrame")return _.grabFrame();if(t==="videoCapture")return d;if(t==="takePhoto"){const g=await _.takePhoto(),m=new Image;return m.src=URL.createObjectURL(g),await new Promise($=>{m.onload=$}),m}}async function p(){const g=await y();return await a.detect(g)}async function D(){const g=await _.grabFrame(),m=document.createElement("canvas"),$=m.getContext("2d");m.width=g.width,m.height=g.height,$.drawImage(g,0,0),m.toBlob(A=>{xt(A)})}function x(g){const m=Date.now()-g;i+=1,r=i>1?(r*(i-1)+m)/i:m,F($=>({...$,scanCount:i,average:r}))}async function S(){try{const g=Date.now(),m=await p();if(u)return;x(g),m.length>0?(n+=1,c=m[0].rawValue,F($=>({...$,barcode:c,success:n}))):(o+=1,F($=>({...$,fail:o})))}catch(g){s+=1,F(m=>({...m,error:s})),console.log(g)}finally{setTimeout(S,100)}}function M(){u=!0}function H(){u=!0,clearInterval(l),M()}const{subscribe:J,update:F}=Oe({mode:t,success:n,fail:o,barcode:c,scanCount:i,error:s,average:r,toggleMode:()=>{const m=(e.indexOf(t)+1)%e.length;t=e[m],F($=>({...$,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{c=null}});return{init:h,subscribe:J,toggleMode:()=>F(g=>({...g,mode:e[(e.indexOf(g.mode)+1)%e.length]})),resetStats:()=>F(g=>({...g,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>F(g=>({...g,barcode:null})),stop:H,start:()=>{S(),l=setInterval(D,5e3)}}}function At(e){var Ee,Ae,Le,Be,je,qe;let t,n,o,s=e[5].scanCount+"",i,r,l,u,c=e[5].average.toFixed(2)+"",_,a,d,h,y=e[5].fail+"",p,D,x,S,M=e[5].success+"",H,J,F,g,m,$,A,B,Q,Pe,ae,Ie,q,I,ee,Ne,L,ue,te=((Le=(Ae=(Ee=e[3])==null?void 0:Ee.capabilities)==null?void 0:Ae.focusDistance)==null?void 0:Le.min.toFixed(2))+"",le,Te,fe,ne=(e[1]?e[1].toFixed(2):"-")+"",de,xe,pe,oe=((qe=(je=(Be=e[3])==null?void 0:Be.capabilities)==null?void 0:je.focusDistance)==null?void 0:qe.max.toFixed(2))+"",me,ge,Me;return{c(){t=b("div"),n=b("div"),o=k("Scan count: "),i=k(s),r=P(),l=b("div"),u=k("Average: "),_=k(c),a=P(),d=b("div"),h=k("Fail: "),p=k(y),D=P(),x=b("div"),S=k("Success: "),H=k(M),J=P(),F=b("video"),F.innerHTML="",g=P(),m=b("div"),$=b("div"),A=b("button"),B=b("img"),Pe=P(),ae=k(e[4]),Ie=P(),q=b("div"),I=b("input"),Ne=P(),L=b("div"),ue=b("span"),le=k(te),Te=P(),fe=b("span"),de=k(ne),xe=P(),pe=b("span"),me=k(oe),v(t,"class","stats svelte-ts9df7"),F.autoplay=!0,v(F,"id","stream"),v(F,"class","svelte-ts9df7"),Ke(B.src,Q=`public/${e[4]}-focus.svg`)||v(B,"src",Q),v(B,"class","svelte-ts9df7"),v(A,"class","svelte-ts9df7"),v($,"class","focus__group svelte-ts9df7"),I.disabled=ee=e[4]==="continuous",v(I,"id","zoom__range"),v(I,"type","range"),v(I,"min","0"),v(I,"max","100"),v(I,"class","svelte-ts9df7"),v(L,"class","focus__range svelte-ts9df7"),v(q,"class","focus__group grow svelte-ts9df7"),v(m,"id","focus"),v(m,"class","svelte-ts9df7")},m(w,C){N(w,t,C),f(t,n),f(n,o),f(n,i),f(t,r),f(t,l),f(l,u),f(l,_),f(t,a),f(t,d),f(d,h),f(d,p),f(t,D),f(t,x),f(x,S),f(x,H),N(w,J,C),N(w,F,C),e[9](F),N(w,g,C),N(w,m,C),f(m,$),f($,A),f(A,B),f($,Pe),f($,ae),f(m,Ie),f(m,q),f(q,I),Xe(I,e[0]),f(q,Ne),f(q,L),f(L,ue),f(ue,le),f(L,Te),f(L,fe),f(fe,de),f(L,xe),f(L,pe),f(pe,me),ge||(Me=[K(A,"click",e[8]),K(I,"change",e[10]),K(I,"input",e[10]),K(I,"change",e[6])],ge=!0)},p(w,[C]){var ze,Ue,Re,Ve,Ze,He;C&32&&s!==(s=w[5].scanCount+"")&&E(i,s),C&32&&c!==(c=w[5].average.toFixed(2)+"")&&E(_,c),C&32&&y!==(y=w[5].fail+"")&&E(p,y),C&32&&M!==(M=w[5].success+"")&&E(H,M),C&16&&!Ke(B.src,Q=`public/${w[4]}-focus.svg`)&&v(B,"src",Q),C&16&&E(ae,w[4]),C&16&&ee!==(ee=w[4]==="continuous")&&(I.disabled=ee),C&1&&Xe(I,w[0]),C&8&&te!==(te=((Re=(Ue=(ze=w[3])==null?void 0:ze.capabilities)==null?void 0:Ue.focusDistance)==null?void 0:Re.min.toFixed(2))+"")&&E(le,te),C&2&&ne!==(ne=(w[1]?w[1].toFixed(2):"-")+"")&&E(de,ne),C&8&&oe!==(oe=((He=(Ze=(Ve=w[3])==null?void 0:Ve.capabilities)==null?void 0:Ze.focusDistance)==null?void 0:He.max.toFixed(2))+"")&&E(me,oe)},i:T,o:T,d(w){w&&(O(t),O(J),O(F),O(g),O(m)),e[9](null),ge=!1,Z(Me)}}}function Lt(e,t,n){let o,s=0,i;async function r(S){console.log(S.target.value),n(0,s=S.target.value);const M=await(a==null?void 0:a.setFocusDistancePct(s));n(1,i=M||void 0)}const l=()=>navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:960},height:{ideal:1280}},audio:!1});let u,c,_,a,d=Et();$e(e,d,S=>n(5,o=S));const h=["continuous","manual"];let y="continuous";const p=async()=>{const S=h[h.indexOf(y)+1]||h[0];try{await a.setFocusMode(y),n(4,y=S)}catch{alert("Could not set focus mode")}};ht(()=>((async()=>{try{c=await l(),n(2,u.srcObject=c,u),_=c.getVideoTracks()[0],n(3,a=Mt(_)),d.init(u,_,u.width,u.height),d.start()}catch(S){console.log("error",S),alert("Could not access the camera")}})(),()=>d==null?void 0:d.stop()));function D(S){be[S?"unshift":"push"](()=>{u=S,n(2,u)})}function x(){s=pt(this.value),n(0,s)}return[s,i,u,a,y,o,r,d,p,D,x]}class Bt extends De{constructor(t){super(),Ce(this,t,Lt,At,re,{})}}const ve="deviceAlias",jt=()=>{const{subscribe:e,set:t}=Oe(localStorage.getItem(ve));return{subscribe:e,ask:()=>{if(localStorage.getItem(ve))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(ve,n),t(n)):alert("You must provide a device alias")}}},nt=jt();function qt(e){let t;return{c(){t=b("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){N(n,t,o)},d(n){n&&O(t)}}}function zt(e){let t;return{c(){t=b("h1"),t.textContent="Waiting for device alias..."},m(n,o){N(n,t,o)},i:T,o:T,d(n){n&&O(t)}}}function Ut(e){let t,n;return t=new Bt({}),{c(){ct(t.$$.fragment)},m(o,s){Se(t,o,s),n=!0},i(o){n||(X(t.$$.fragment,o),n=!0)},o(o){ce(t.$$.fragment,o),n=!1},d(o){Fe(t,o)}}}function Rt(e){let t,n,o,s,i,r,l,u,c,_;o=new Pt({});let a=!e[1]&&qt();const d=[Ut,zt],h=[];function y(p,D){return p[0]?0:1}return l=y(e),u=h[l]=d[l](e),{c(){t=b("meta"),n=P(),ct(o.$$.fragment),s=P(),i=b("main"),a&&a.c(),r=P(),u.c(),c=dt(),v(t,"name","viewport"),v(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(p,D){f(document.head,t),N(p,n,D),Se(o,p,D),N(p,s,D),N(p,i,D),a&&a.m(i,null),N(p,r,D),h[l].m(p,D),N(p,c,D),_=!0},p(p,[D]){let x=l;l=y(p),l!==x&&(wt(),ce(h[x],1,1,()=>{h[x]=null}),$t(),u=h[l],u||(u=h[l]=d[l](p),u.c()),X(u,1),u.m(c.parentNode,c))},i(p){_||(X(o.$$.fragment,p),X(u),_=!0)},o(p){ce(o.$$.fragment,p),ce(u),_=!1},d(p){p&&(O(n),O(s),O(i),O(r),O(c)),O(t),Fe(o,p),a&&a.d(),h[l].d(p)}}}function Vt(e,t,n){let o;$e(e,nt,i=>n(0,o=i));const s=typeof BarcodeDetector<"u";return nt.ask(),[o,s]}class Zt extends De{constructor(t){super(),Ce(this,t,Vt,Rt,re,{})}}new Zt({target:document.getElementById("app")});
