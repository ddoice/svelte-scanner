var mt=Object.defineProperty;var gt=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $e=(e,t,n)=>(gt(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function k(){}function ut(e){return e()}function tt(){return Object.create(null)}function W(e){e.forEach(ut)}function ft(e){return typeof e=="function"}function de(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let ae;function le(e,t){return e===t?!0:(ae||(ae=document.createElement("a")),ae.href=t,e===ae.href)}function ht(e){return Object.keys(e).length===0}function _t(e,...t){if(e==null){for(const o of t)o(void 0);return k}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Oe(e,t,n){e.$$.on_destroy.push(_t(t,n))}function nt(e){return e??""}function l(e,t){e.appendChild(t)}function j(e,t,n){e.insertBefore(t,n||null)}function O(e){e.parentNode&&e.parentNode.removeChild(e)}function vt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function _(e){return document.createElement(e)}function M(e){return document.createTextNode(e)}function D(){return M(" ")}function bt(){return M("")}function H(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function h(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function yt(e){return e===""?null:+e}function wt(e){return Array.from(e.childNodes)}function N(e,t){t=""+t,e.data!==t&&(e.data=t)}function ot(e,t){e.value=t??""}let ee;function G(e){ee=e}function $t(){if(!ee)throw new Error("Function called outside component initialization");return ee}function St(e){$t().$$.on_mount.push(e)}const J=[],Ce=[];let K=[];const st=[],Ft=Promise.resolve();let De=!1;function Ct(){De||(De=!0,Ft.then(dt))}function Me(e){K.push(e)}const Se=new Set;let V=0;function dt(){if(V!==0)return;const e=ee;do{try{for(;V<J.length;){const t=J[V];V++,G(t),Dt(t.$$)}}catch(t){throw J.length=0,V=0,t}for(G(null),J.length=0,V=0;Ce.length;)Ce.pop()();for(let t=0;t<K.length;t+=1){const n=K[t];Se.has(n)||(Se.add(n),n())}K.length=0}while(J.length);for(;st.length;)st.pop()();De=!1,Se.clear(),G(e)}function Dt(e){if(e.fragment!==null){e.update(),W(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Me)}}function Mt(e){const t=[],n=[];K.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),K=t}const ue=new Set;let z;function Ot(){z={r:0,c:[],p:z}}function Pt(){z.r||W(z.c),z=z.p}function Q(e,t){e&&e.i&&(ue.delete(e),e.i(t))}function fe(e,t,n,o){if(e&&e.o){if(ue.has(e))return;ue.add(e),z.c.push(()=>{ue.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function it(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function pt(e){e&&e.c()}function Pe(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),Me(()=>{const i=e.$$.on_mount.map(ut).filter(ft);e.$$.on_destroy?e.$$.on_destroy.push(...i):W(i),e.$$.on_mount=[]}),s.forEach(Me)}function je(e,t){const n=e.$$;n.fragment!==null&&(Mt(n.after_update),W(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function jt(e,t){e.$$.dirty[0]===-1&&(J.push(e),Ct(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ke(e,t,n,o,s,i,r=null,u=[-1]){const d=ee;G(e);const c=e.$$={fragment:null,ctx:[],props:i,update:k,not_equal:s,bound:tt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(d?d.$$.context:[])),callbacks:tt(),dirty:u,skip_bound:!1,root:t.target||d.$$.root};r&&r(c.root);let b=!1;if(c.ctx=n?n(e,t.props||{},(a,g,...m)=>{const S=m.length?m[0]:g;return c.ctx&&s(c.ctx[a],c.ctx[a]=S)&&(!c.skip_bound&&c.bound[a]&&c.bound[a](S),b&&jt(e,a)),g}):[],c.update(),b=!0,W(c.before_update),c.fragment=o?o(c.ctx):!1,t.target){if(t.hydrate){const a=wt(t.target);c.fragment&&c.fragment.l(a),a.forEach(O)}else c.fragment&&c.fragment.c();t.intro&&Q(e.$$.fragment),Pe(e,t.target,t.anchor),dt()}G(d)}class Ie{constructor(){$e(this,"$$");$e(this,"$$set")}$destroy(){je(this,1),this.$destroy=k}$on(t,n){if(!ft(n))return k;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!ht(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const kt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(kt);const Z=[];function Ne(e,t=k){let n;const o=new Set;function s(u){if(de(e,u)&&(e=u,n)){const d=!Z.length;for(const c of o)c[1](),Z.push(c,e);if(d){for(let c=0;c<Z.length;c+=2)Z[c][0](Z[c+1]);Z.length=0}}}function i(u){s(u(e))}function r(u,d=k){const c=[u,d];return o.add(c),o.size===1&&(n=t(s,i)||k),u(e),()=>{o.delete(c),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:r}}let ct=0;const It=3e3;function Nt(){const{subscribe:e,update:t}=Ne([]);function n(s){ct+=1;const i=ct,r={...s,id:i};t(u=>[...u,r].slice(-5)),setTimeout(()=>{o(i)},It)}function o(s){t(i=>i.filter(r=>r.id!==s))}return{subscribe:e,addNotification:n,closeNotification:o}}const te=Nt();function rt(e,t,n){const o=e.slice();return o[2]=t[n],o}function at(e){let t,n,o=e[2].text+"",s,i,r,u,d,c,b;function a(){return e[1](e[2])}return{c(){t=_("div"),n=_("div"),s=M(o),i=D(),r=_("button"),r.textContent="X",u=D(),h(r,"class","svelte-1mipv5u"),h(t,"class",d=nt(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(g,m){j(g,t,m),l(t,n),l(n,s),l(t,i),l(t,r),l(t,u),c||(b=H(r,"click",a),c=!0)},p(g,m){e=g,m&1&&o!==(o=e[2].text+"")&&N(s,o),m&1&&d!==(d=nt(`notification ${e[2].type}`)+" svelte-1mipv5u")&&h(t,"class",d)},d(g){g&&O(t),c=!1,b()}}}function Tt(e){let t,n=it(e[0]),o=[];for(let s=0;s<n.length;s+=1)o[s]=at(rt(e,n,s));return{c(){t=_("div");for(let s=0;s<o.length;s+=1)o[s].c();h(t,"id","notifications-container"),h(t,"class","svelte-1mipv5u")},m(s,i){j(s,t,i);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(t,null)},p(s,[i]){if(i&1){n=it(s[0]);let r;for(r=0;r<n.length;r+=1){const u=rt(s,n,r);o[r]?o[r].p(u,i):(o[r]=at(u),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},i:k,o:k,d(s){s&&O(t),vt(o,s)}}}function qt(e,t,n){let o;return Oe(e,te,i=>n(0,o=i)),[o,i=>te.closeNotification(i.id)]}class Et extends Ie{constructor(t){super(),ke(this,t,qt,Tt,de,{})}}const At="https://yup.perfdive.com/api",Te=async(e,t)=>{const n=await fetch(`${At}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},xt=async e=>{try{return await Te("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),te.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},Lt=async e=>{try{return await Te("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),te.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},Bt=async e=>{const t=new FormData;t.append("photo",e);try{const n=await Te("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),te.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},zt=e=>{const t=e.getCapabilities(),n=e.getSettings();return xt(t),Lt(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:a}=t;return a&&(a.max-a.min)/a.step,a},getSettings:()=>e.getSettings(),setFocusMode:a=>e.applyConstraints({advanced:[{focusMode:a}]}),setFocusDistance:a=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}),setTorch:a=>{t.torch&&e.applyConstraints({advanced:[{torch:a}]})},settings:n,setFocusDistancePct:async a=>{const{focusDistance:g}=t;if(!g){alert("Focus distance not supported");return}const m=(g.max-g.min)/100,S=g.min+m*a;try{await e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:S}]})}catch(p){alert(p.message),console.error(p)}return S},setZoom:a=>e.applyConstraints({advanced:[{zoom:a}]})}};function Ut(){const e=["grabFrame","videoCapture","takePhoto"];let t="grabFrame",n=0,o=0,s=0,i=0,r=0,u,d=!1,c=null,b,a,g;function m(f,v,w,T){g=f,b=new ImageCapture(v),a=new BarcodeDetector({formats:["pdf417"]})}async function S(){if(t==="grabFrame")return b.grabFrame();if(t==="videoCapture")return g;if(t==="takePhoto"){const f=await b.takePhoto(),v=new Image;return v.src=URL.createObjectURL(f),await new Promise(w=>{v.onload=w}),v}}async function p(){const f=await S();return await a.detect(f)}async function C(){try{const f=await b.grabFrame(),v=document.createElement("canvas"),w=v.getContext("2d");v.width=f.width,v.height=f.height,w.drawImage(f,0,0),v.toBlob(T=>{Bt(T)})}catch(f){console.log(f)}}function I(f){const v=Date.now()-f;i+=1,r=i>1?(r*(i-1)+v)/i:v,y(w=>({...w,scanCount:i,average:r}))}async function A(){try{const f=Date.now(),v=await p();if(d)return;I(f),v.length>0?(n+=1,c=v[0].rawValue,y(w=>({...w,barcode:c,success:n}))):(o+=1,y(w=>({...w,fail:o})))}catch(f){s+=1,y(v=>({...v,error:s})),console.log(f)}finally{setTimeout(A,100)}}function q(){d=!0,clearInterval(u)}const{subscribe:x,update:y}=Ne({mode:t,success:n,fail:o,barcode:c,scanCount:i,error:s,average:r,toggleMode:()=>{const v=(e.indexOf(t)+1)%e.length;t=e[v],y(w=>({...w,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{c=null}});return{init:m,subscribe:x,toggleMode:()=>y(f=>({...f,mode:e[(e.indexOf(f.mode)+1)%e.length]})),resetStats:()=>y(f=>({...f,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>y(f=>({...f,barcode:null})),stop:q,start:()=>{d=!1,A(),u=setInterval(C,5e3)}}}function Rt(e){var Re,Ve,Ze,He,Je,Ke;let t,n,o,s=e[6].scanCount+"",i,r,u,d,c=e[6].average.toFixed(2)+"",b,a,g,m,S=e[6].fail+"",p,C,I,A,q=e[6].success+"",x,y,f,v,w,T,X,L,ne,qe,pe,Ee,U,P,oe,Ae,E,me,se=((Ze=(Ve=(Re=e[4])==null?void 0:Re.capabilities)==null?void 0:Ve.focusDistance)==null?void 0:Ze.min.toFixed(2))+"",ge,xe,he,ie=(e[1]?e[1].toFixed(2):"-")+"",_e,Le,ve,ce=((Ke=(Je=(He=e[4])==null?void 0:He.capabilities)==null?void 0:Je.focusDistance)==null?void 0:Ke.max.toFixed(2))+"",be,Be,R,Y,B,re,ze,ye,we,Ue;return{c(){t=_("div"),n=_("div"),o=M("Scan count: "),i=M(s),r=D(),u=_("div"),d=M("Average: "),b=M(c),a=D(),g=_("div"),m=M("Fail: "),p=M(S),C=D(),I=_("div"),A=M("Success: "),x=M(q),y=D(),f=_("video"),f.innerHTML="",v=D(),w=_("div"),T=_("div"),X=_("button"),L=_("img"),qe=D(),pe=M(e[5]),Ee=D(),U=_("div"),P=_("input"),Ae=D(),E=_("div"),me=_("span"),ge=M(se),xe=D(),he=_("span"),_e=M(ie),Le=D(),ve=_("span"),be=M(ce),Be=D(),R=_("div"),Y=_("button"),B=_("img"),ze=D(),ye=M(e[2]),h(t,"class","stats svelte-j6ouqi"),f.autoplay=!0,h(f,"id","stream"),h(f,"class","svelte-j6ouqi"),le(L.src,ne=`public/${e[5]}-focus.svg`)||h(L,"src",ne),h(L,"class","svelte-j6ouqi"),h(X,"class","svelte-j6ouqi"),h(T,"class","focus__group svelte-j6ouqi"),P.disabled=oe=e[5]==="continuous",h(P,"id","zoom__range"),h(P,"type","range"),h(P,"min","0"),h(P,"max","100"),h(P,"class","svelte-j6ouqi"),h(E,"class","focus__range svelte-j6ouqi"),h(U,"class","focus__group grow svelte-j6ouqi"),le(B.src,re=`public/${e[2]}-facingMode.svg`)||h(B,"src",re),h(B,"class","svelte-j6ouqi"),h(Y,"class","svelte-j6ouqi"),h(R,"class","focus__group svelte-j6ouqi"),h(w,"id","focus"),h(w,"class","svelte-j6ouqi")},m($,F){j($,t,F),l(t,n),l(n,o),l(n,i),l(t,r),l(t,u),l(u,d),l(u,b),l(t,a),l(t,g),l(g,m),l(g,p),l(t,C),l(t,I),l(I,A),l(I,x),j($,y,F),j($,f,F),e[11](f),j($,v,F),j($,w,F),l(w,T),l(T,X),l(X,L),l(T,qe),l(T,pe),l(w,Ee),l(w,U),l(U,P),ot(P,e[0]),l(U,Ae),l(U,E),l(E,me),l(me,ge),l(E,xe),l(E,he),l(he,_e),l(E,Le),l(E,ve),l(ve,be),l(w,Be),l(w,R),l(R,Y),l(Y,B),l(R,ze),l(R,ye),we||(Ue=[H(X,"click",e[9]),H(P,"change",e[12]),H(P,"input",e[12]),H(P,"change",e[7]),H(Y,"click",e[10])],we=!0)},p($,[F]){var We,Xe,Ye,Ge,Qe,et;F&64&&s!==(s=$[6].scanCount+"")&&N(i,s),F&64&&c!==(c=$[6].average.toFixed(2)+"")&&N(b,c),F&64&&S!==(S=$[6].fail+"")&&N(p,S),F&64&&q!==(q=$[6].success+"")&&N(x,q),F&32&&!le(L.src,ne=`public/${$[5]}-focus.svg`)&&h(L,"src",ne),F&32&&N(pe,$[5]),F&32&&oe!==(oe=$[5]==="continuous")&&(P.disabled=oe),F&1&&ot(P,$[0]),F&16&&se!==(se=((Ye=(Xe=(We=$[4])==null?void 0:We.capabilities)==null?void 0:Xe.focusDistance)==null?void 0:Ye.min.toFixed(2))+"")&&N(ge,se),F&2&&ie!==(ie=($[1]?$[1].toFixed(2):"-")+"")&&N(_e,ie),F&16&&ce!==(ce=((et=(Qe=(Ge=$[4])==null?void 0:Ge.capabilities)==null?void 0:Qe.focusDistance)==null?void 0:et.max.toFixed(2))+"")&&N(be,ce),F&4&&!le(B.src,re=`public/${$[2]}-facingMode.svg`)&&h(B,"src",re),F&4&&N(ye,$[2])},i:k,o:k,d($){$&&(O(t),O(y),O(f),O(v),O(w)),e[11](null),we=!1,W(Ue)}}}function Vt(e,t,n){let o,s=0,i,r="environment";async function u(y){console.log(y.target.value),n(0,s=y.target.value);const f=await(g==null?void 0:g.setFocusDistancePct(s));n(1,i=f||void 0)}const d=()=>navigator.mediaDevices.getUserMedia({video:{facingMode:r,width:{ideal:960},height:{ideal:1280}},audio:!1});let c,b,a,g,m=Ut();Oe(e,m,y=>n(6,o=y));const S=["continuous","manual"];let p="continuous";const C=async()=>{try{a==null||a.stop(),m==null||m.stop(),b=await d(),n(3,c.srcObject=b,c),a=b.getVideoTracks()[0],n(4,g=zt(a)),m.init(c,a,c.width,c.height),m.start()}catch(y){console.log("error",y),alert("Could not access the camera")}},I=async()=>{const y=S[S.indexOf(p)+1]||S[0];try{await g.setFocusMode(p),n(5,p=y)}catch{alert("Could not set focus mode")}},A=async()=>{n(2,r=r==="environment"?"user":"environment"),await C()};St(()=>((async()=>await C())(),()=>m==null?void 0:m.stop()));function q(y){Ce[y?"unshift":"push"](()=>{c=y,n(3,c)})}function x(){s=yt(this.value),n(0,s)}return[s,i,r,c,g,p,o,u,m,I,A,q,x]}class Zt extends Ie{constructor(t){super(),ke(this,t,Vt,Rt,de,{})}}const Fe="deviceAlias",Ht=()=>{const{subscribe:e,set:t}=Ne(localStorage.getItem(Fe));return{subscribe:e,ask:()=>{if(localStorage.getItem(Fe))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(Fe,n),t(n)):alert("You must provide a device alias")}}},lt=Ht();function Jt(e){let t;return{c(){t=_("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){j(n,t,o)},d(n){n&&O(t)}}}function Kt(e){let t;return{c(){t=_("h1"),t.textContent="Waiting for device alias..."},m(n,o){j(n,t,o)},i:k,o:k,d(n){n&&O(t)}}}function Wt(e){let t,n;return t=new Zt({}),{c(){pt(t.$$.fragment)},m(o,s){Pe(t,o,s),n=!0},i(o){n||(Q(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}function Xt(e){let t,n,o,s,i,r,u,d,c,b;o=new Et({});let a=!e[1]&&Jt();const g=[Wt,Kt],m=[];function S(p,C){return p[0]?0:1}return u=S(e),d=m[u]=g[u](e),{c(){t=_("meta"),n=D(),pt(o.$$.fragment),s=D(),i=_("main"),a&&a.c(),r=D(),d.c(),c=bt(),h(t,"name","viewport"),h(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(p,C){l(document.head,t),j(p,n,C),Pe(o,p,C),j(p,s,C),j(p,i,C),a&&a.m(i,null),j(p,r,C),m[u].m(p,C),j(p,c,C),b=!0},p(p,[C]){let I=u;u=S(p),u!==I&&(Ot(),fe(m[I],1,1,()=>{m[I]=null}),Pt(),d=m[u],d||(d=m[u]=g[u](p),d.c()),Q(d,1),d.m(c.parentNode,c))},i(p){b||(Q(o.$$.fragment,p),Q(d),b=!0)},o(p){fe(o.$$.fragment,p),fe(d),b=!1},d(p){p&&(O(n),O(s),O(i),O(r),O(c)),O(t),je(o,p),a&&a.d(),m[u].d(p)}}}function Yt(e,t,n){let o;Oe(e,lt,i=>n(0,o=i));const s=typeof BarcodeDetector<"u";return lt.ask(),[o,s]}class Gt extends Ie{constructor(t){super(),ke(this,t,Yt,Xt,de,{})}}new Gt({target:document.getElementById("app")});
