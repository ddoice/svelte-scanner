var mt=Object.defineProperty;var gt=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $e=(e,t,n)=>(gt(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function I(){}function lt(e){return e()}function tt(){return Object.create(null)}function X(e){e.forEach(lt)}function ft(e){return typeof e=="function"}function de(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let ae;function ue(e,t){return e===t?!0:(ae||(ae=document.createElement("a")),ae.href=t,e===ae.href)}function ht(e){return Object.keys(e).length===0}function _t(e,...t){if(e==null){for(const o of t)o(void 0);return I}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Oe(e,t,n){e.$$.on_destroy.push(_t(t,n))}function nt(e){return e??""}function u(e,t){e.appendChild(t)}function k(e,t,n){e.insertBefore(t,n||null)}function P(e){e.parentNode&&e.parentNode.removeChild(e)}function vt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function v(e){return document.createElement(e)}function O(e){return document.createTextNode(e)}function M(){return O(" ")}function bt(){return O("")}function J(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function _(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function yt(e){return e===""?null:+e}function wt(e){return Array.from(e.childNodes)}function T(e,t){t=""+t,e.data!==t&&(e.data=t)}function ot(e,t){e.value=t??""}let ee;function G(e){ee=e}function $t(){if(!ee)throw new Error("Function called outside component initialization");return ee}function St(e){$t().$$.on_mount.push(e)}const K=[],Ce=[];let W=[];const st=[],Ft=Promise.resolve();let De=!1;function Ct(){De||(De=!0,Ft.then(dt))}function Me(e){W.push(e)}const Se=new Set;let Z=0;function dt(){if(Z!==0)return;const e=ee;do{try{for(;Z<K.length;){const t=K[Z];Z++,G(t),Dt(t.$$)}}catch(t){throw K.length=0,Z=0,t}for(G(null),K.length=0,Z=0;Ce.length;)Ce.pop()();for(let t=0;t<W.length;t+=1){const n=W[t];Se.has(n)||(Se.add(n),n())}W.length=0}while(K.length);for(;st.length;)st.pop()();De=!1,Se.clear(),G(e)}function Dt(e){if(e.fragment!==null){e.update(),X(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Me)}}function Mt(e){const t=[],n=[];W.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),W=t}const le=new Set;let U;function Ot(){U={r:0,c:[],p:U}}function Pt(){U.r||X(U.c),U=U.p}function Q(e,t){e&&e.i&&(le.delete(e),e.i(t))}function fe(e,t,n,o){if(e&&e.o){if(le.has(e))return;le.add(e),U.c.push(()=>{le.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function it(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function pt(e){e&&e.c()}function Pe(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),Me(()=>{const i=e.$$.on_mount.map(lt).filter(ft);e.$$.on_destroy?e.$$.on_destroy.push(...i):X(i),e.$$.on_mount=[]}),s.forEach(Me)}function je(e,t){const n=e.$$;n.fragment!==null&&(Mt(n.after_update),X(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function jt(e,t){e.$$.dirty[0]===-1&&(K.push(e),Ct(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ke(e,t,n,o,s,i,r=null,l=[-1]){const f=ee;G(e);const c=e.$$={fragment:null,ctx:[],props:i,update:I,not_equal:s,bound:tt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:tt(),dirty:l,skip_bound:!1,root:t.target||f.$$.root};r&&r(c.root);let b=!1;if(c.ctx=n?n(e,t.props||{},(a,g,...p)=>{const $=p.length?p[0]:g;return c.ctx&&s(c.ctx[a],c.ctx[a]=$)&&(!c.skip_bound&&c.bound[a]&&c.bound[a]($),b&&jt(e,a)),g}):[],c.update(),b=!0,X(c.before_update),c.fragment=o?o(c.ctx):!1,t.target){if(t.hydrate){const a=wt(t.target);c.fragment&&c.fragment.l(a),a.forEach(P)}else c.fragment&&c.fragment.c();t.intro&&Q(e.$$.fragment),Pe(e,t.target,t.anchor),dt()}G(f)}class Ie{constructor(){$e(this,"$$");$e(this,"$$set")}$destroy(){je(this,1),this.$destroy=I}$on(t,n){if(!ft(n))return I;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!ht(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const kt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(kt);const H=[];function Ne(e,t=I){let n;const o=new Set;function s(l){if(de(e,l)&&(e=l,n)){const f=!H.length;for(const c of o)c[1](),H.push(c,e);if(f){for(let c=0;c<H.length;c+=2)H[c][0](H[c+1]);H.length=0}}}function i(l){s(l(e))}function r(l,f=I){const c=[l,f];return o.add(c),o.size===1&&(n=t(s,i)||I),l(e),()=>{o.delete(c),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:r}}let ct=0;const It=3e3;function Nt(){const{subscribe:e,update:t}=Ne([]);function n(s){ct+=1;const i=ct,r={...s,id:i};t(l=>[...l,r].slice(-5)),setTimeout(()=>{o(i)},It)}function o(s){t(i=>i.filter(r=>r.id!==s))}return{subscribe:e,addNotification:n,closeNotification:o}}const te=Nt();function rt(e,t,n){const o=e.slice();return o[2]=t[n],o}function at(e){let t,n,o=e[2].text+"",s,i,r,l,f,c,b;function a(){return e[1](e[2])}return{c(){t=v("div"),n=v("div"),s=O(o),i=M(),r=v("button"),r.textContent="X",l=M(),_(r,"class","svelte-1mipv5u"),_(t,"class",f=nt(`notification ${e[2].type}`)+" svelte-1mipv5u")},m(g,p){k(g,t,p),u(t,n),u(n,s),u(t,i),u(t,r),u(t,l),c||(b=J(r,"click",a),c=!0)},p(g,p){e=g,p&1&&o!==(o=e[2].text+"")&&T(s,o),p&1&&f!==(f=nt(`notification ${e[2].type}`)+" svelte-1mipv5u")&&_(t,"class",f)},d(g){g&&P(t),c=!1,b()}}}function Tt(e){let t,n=it(e[0]),o=[];for(let s=0;s<n.length;s+=1)o[s]=at(rt(e,n,s));return{c(){t=v("div");for(let s=0;s<o.length;s+=1)o[s].c();_(t,"id","notifications-container"),_(t,"class","svelte-1mipv5u")},m(s,i){k(s,t,i);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(t,null)},p(s,[i]){if(i&1){n=it(s[0]);let r;for(r=0;r<n.length;r+=1){const l=rt(s,n,r);o[r]?o[r].p(l,i):(o[r]=at(l),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},i:I,o:I,d(s){s&&P(t),vt(o,s)}}}function qt(e,t,n){let o;return Oe(e,te,i=>n(0,o=i)),[o,i=>te.closeNotification(i.id)]}class Et extends Ie{constructor(t){super(),ke(this,t,qt,Tt,de,{})}}const At="https://yup.perfdive.com/api",Te=async(e,t)=>{const n=await fetch(`${At}${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},xt=async e=>{try{return await Te("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackCapabilities"},body:JSON.stringify(e)})}catch(t){console.error(t),te.addNotification({text:"sendTrackCapabilities failed, "+t.message,type:"error"})}},Lt=async e=>{try{return await Te("/log",{method:"POST",headers:{"Content-Type":"application/json",device:localStorage.getItem("deviceAlias"),event:"trackSettings"},body:JSON.stringify(e)})}catch(t){console.error(t),te.addNotification({text:"sendTrackSettings failed, "+t.message,type:"error"})}},Bt=async e=>{const t=new FormData;t.append("photo",e);try{const n=await Te("/upload",{method:"POST",body:t,headers:{device:localStorage.getItem("deviceAlias"),event:"trackSettings"}})}catch(n){console.error(n),te.addNotification({text:"sendPhoto failed, "+n.message,type:"error"})}},zt=e=>{const t=e.getCapabilities(),n=e.getSettings();return xt(t),Lt(n),{capabilities:t,canAutoFocus:()=>t.focusDistance&&t.focusMode&&(t==null?void 0:t.focusMode.includes("manual"))||!1,getFocusDistance:()=>{const{focusDistance:a}=t;return a&&(a.max-a.min)/a.step,a},getSettings:()=>e.getSettings(),setFocusMode:a=>e.applyConstraints({advanced:[{focusMode:a}]}),setFocusDistance:a=>e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}),setTorch:a=>{t.torch&&e.applyConstraints({advanced:[{torch:a}]})},settings:n,setFocusDistancePct:async a=>{const{focusDistance:g}=t;if(!g){alert("Focus distance not supported");return}const p=(g.max-g.min)/100,$=g.min+p*a;try{await e.applyConstraints({advanced:[{focusMode:"manual",focusDistance:$}]})}catch(d){alert(d.message),console.error(d)}return $},setZoom:a=>e.applyConstraints({advanced:[{zoom:a}]})}};function Ut(){const e=["grabFrame","videoCapture","takePhoto"];let t="grabFrame",n=0,o=0,s=0,i=0,r=0,l,f=!1,c=null,b,a,g;function p(h,m,S,E){g=h,b=new ImageCapture(m),a=new BarcodeDetector({formats:["pdf417"]})}async function $(){if(t==="grabFrame")return b.grabFrame();if(t==="videoCapture")return g;if(t==="takePhoto"){const h=await b.takePhoto(),m=new Image;return m.src=URL.createObjectURL(h),await new Promise(S=>{m.onload=S}),m}}async function d(){const h=await $();return await a.detect(h)}async function C(){try{const h=await b.grabFrame(),m=document.createElement("canvas"),S=m.getContext("2d");m.width=h.width,m.height=h.height,S.drawImage(h,0,0),m.toBlob(E=>{Bt(E)})}catch(h){console.log(h)}}function N(h){const m=Date.now()-h;i+=1,r=i>1?(r*(i-1)+m)/i:m,w(S=>({...S,scanCount:i,average:r}))}async function x(){try{const h=Date.now(),m=await d();if(f)return;N(h),m.length>0?(n+=1,c=m[0].rawValue,w(S=>({...S,barcode:c,success:n}))):(o+=1,w(S=>({...S,fail:o})))}catch(h){s+=1,w(m=>({...m,error:s})),console.log(h)}finally{setTimeout(x,100)}}function q(){f=!0}function L(){f=!0,clearInterval(l),q()}const{subscribe:D,update:w}=Ne({mode:t,success:n,fail:o,barcode:c,scanCount:i,error:s,average:r,toggleMode:()=>{const m=(e.indexOf(t)+1)%e.length;t=e[m],w(S=>({...S,mode:t}))},resetStats:()=>{n=0,o=0},resetBarcode:()=>{c=null}});return{init:p,subscribe:D,toggleMode:()=>w(h=>({...h,mode:e[(e.indexOf(h.mode)+1)%e.length]})),resetStats:()=>w(h=>({...h,success:0,fail:0,error:0,scanCount:0,average:0})),resetBarcode:()=>w(h=>({...h,barcode:null})),stop:L,start:()=>{x(),l=setInterval(C,5e3)}}}function Rt(e){var Re,Ve,Ze,He,Je,Ke;let t,n,o,s=e[6].scanCount+"",i,r,l,f,c=e[6].average.toFixed(2)+"",b,a,g,p,$=e[6].fail+"",d,C,N,x,q=e[6].success+"",L,D,w,h,m,S,E,B,ne,qe,pe,Ee,R,j,oe,Ae,A,me,se=((Ze=(Ve=(Re=e[4])==null?void 0:Re.capabilities)==null?void 0:Ve.focusDistance)==null?void 0:Ze.min.toFixed(2))+"",ge,xe,he,ie=(e[1]?e[1].toFixed(2):"-")+"",_e,Le,ve,ce=((Ke=(Je=(He=e[4])==null?void 0:He.capabilities)==null?void 0:Je.focusDistance)==null?void 0:Ke.max.toFixed(2))+"",be,Be,V,Y,z,re,ze,ye,we,Ue;return{c(){t=v("div"),n=v("div"),o=O("Scan count: "),i=O(s),r=M(),l=v("div"),f=O("Average: "),b=O(c),a=M(),g=v("div"),p=O("Fail: "),d=O($),C=M(),N=v("div"),x=O("Success: "),L=O(q),D=M(),w=v("video"),w.innerHTML="",h=M(),m=v("div"),S=v("div"),E=v("button"),B=v("img"),qe=M(),pe=O(e[5]),Ee=M(),R=v("div"),j=v("input"),Ae=M(),A=v("div"),me=v("span"),ge=O(se),xe=M(),he=v("span"),_e=O(ie),Le=M(),ve=v("span"),be=O(ce),Be=M(),V=v("div"),Y=v("button"),z=v("img"),ze=M(),ye=O(e[2]),_(t,"class","stats svelte-j6ouqi"),w.autoplay=!0,_(w,"id","stream"),_(w,"class","svelte-j6ouqi"),ue(B.src,ne=`public/${e[5]}-focus.svg`)||_(B,"src",ne),_(B,"class","svelte-j6ouqi"),_(E,"class","svelte-j6ouqi"),_(S,"class","focus__group svelte-j6ouqi"),j.disabled=oe=e[5]==="continuous",_(j,"id","zoom__range"),_(j,"type","range"),_(j,"min","0"),_(j,"max","100"),_(j,"class","svelte-j6ouqi"),_(A,"class","focus__range svelte-j6ouqi"),_(R,"class","focus__group grow svelte-j6ouqi"),ue(z.src,re=`public/${e[2]}-facingMode.svg`)||_(z,"src",re),_(z,"class","svelte-j6ouqi"),_(Y,"class","svelte-j6ouqi"),_(V,"class","focus__group svelte-j6ouqi"),_(m,"id","focus"),_(m,"class","svelte-j6ouqi")},m(y,F){k(y,t,F),u(t,n),u(n,o),u(n,i),u(t,r),u(t,l),u(l,f),u(l,b),u(t,a),u(t,g),u(g,p),u(g,d),u(t,C),u(t,N),u(N,x),u(N,L),k(y,D,F),k(y,w,F),e[11](w),k(y,h,F),k(y,m,F),u(m,S),u(S,E),u(E,B),u(S,qe),u(S,pe),u(m,Ee),u(m,R),u(R,j),ot(j,e[0]),u(R,Ae),u(R,A),u(A,me),u(me,ge),u(A,xe),u(A,he),u(he,_e),u(A,Le),u(A,ve),u(ve,be),u(m,Be),u(m,V),u(V,Y),u(Y,z),u(V,ze),u(V,ye),we||(Ue=[J(E,"click",e[9]),J(j,"change",e[12]),J(j,"input",e[12]),J(j,"change",e[7]),J(Y,"click",e[10])],we=!0)},p(y,[F]){var We,Xe,Ye,Ge,Qe,et;F&64&&s!==(s=y[6].scanCount+"")&&T(i,s),F&64&&c!==(c=y[6].average.toFixed(2)+"")&&T(b,c),F&64&&$!==($=y[6].fail+"")&&T(d,$),F&64&&q!==(q=y[6].success+"")&&T(L,q),F&32&&!ue(B.src,ne=`public/${y[5]}-focus.svg`)&&_(B,"src",ne),F&32&&T(pe,y[5]),F&32&&oe!==(oe=y[5]==="continuous")&&(j.disabled=oe),F&1&&ot(j,y[0]),F&16&&se!==(se=((Ye=(Xe=(We=y[4])==null?void 0:We.capabilities)==null?void 0:Xe.focusDistance)==null?void 0:Ye.min.toFixed(2))+"")&&T(ge,se),F&2&&ie!==(ie=(y[1]?y[1].toFixed(2):"-")+"")&&T(_e,ie),F&16&&ce!==(ce=((et=(Qe=(Ge=y[4])==null?void 0:Ge.capabilities)==null?void 0:Qe.focusDistance)==null?void 0:et.max.toFixed(2))+"")&&T(be,ce),F&4&&!ue(z.src,re=`public/${y[2]}-facingMode.svg`)&&_(z,"src",re),F&4&&T(ye,y[2])},i:I,o:I,d(y){y&&(P(t),P(D),P(w),P(h),P(m)),e[11](null),we=!1,X(Ue)}}}function Vt(e,t,n){let o,s=0,i,r="environment";async function l(D){console.log(D.target.value),n(0,s=D.target.value);const w=await(g==null?void 0:g.setFocusDistancePct(s));n(1,i=w||void 0)}const f=()=>navigator.mediaDevices.getUserMedia({video:{facingMode:r,width:{ideal:960},height:{ideal:1280}},audio:!1});let c,b,a,g,p=Ut();Oe(e,p,D=>n(6,o=D));const $=["continuous","manual"];let d="continuous";const C=async()=>{try{a==null||a.stop(),p==null||p.stop(),b=await f(),n(3,c.srcObject=b,c),a=b.getVideoTracks()[0],n(4,g=zt(a)),p.init(c,a,c.width,c.height),p.start()}catch(D){console.log("error",D),alert("Could not access the camera")}},N=async()=>{const D=$[$.indexOf(d)+1]||$[0];try{await g.setFocusMode(d),n(5,d=D)}catch{alert("Could not set focus mode")}},x=async()=>{n(2,r=r==="environment"?"user":"environment"),await C()};St(()=>((async()=>await C())(),()=>p==null?void 0:p.stop()));function q(D){Ce[D?"unshift":"push"](()=>{c=D,n(3,c)})}function L(){s=yt(this.value),n(0,s)}return[s,i,r,c,g,d,o,l,p,N,x,q,L]}class Zt extends Ie{constructor(t){super(),ke(this,t,Vt,Rt,de,{})}}const Fe="deviceAlias",Ht=()=>{const{subscribe:e,set:t}=Ne(localStorage.getItem(Fe));return{subscribe:e,ask:()=>{if(localStorage.getItem(Fe))return;let n=prompt("Please input your device alias","device");n?(localStorage.setItem(Fe,n),t(n)):alert("You must provide a device alias")}}},ut=Ht();function Jt(e){let t;return{c(){t=v("h1"),t.textContent="BarcodeDetector not supported."},m(n,o){k(n,t,o)},d(n){n&&P(t)}}}function Kt(e){let t;return{c(){t=v("h1"),t.textContent="Waiting for device alias..."},m(n,o){k(n,t,o)},i:I,o:I,d(n){n&&P(t)}}}function Wt(e){let t,n;return t=new Zt({}),{c(){pt(t.$$.fragment)},m(o,s){Pe(t,o,s),n=!0},i(o){n||(Q(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}function Xt(e){let t,n,o,s,i,r,l,f,c,b;o=new Et({});let a=!e[1]&&Jt();const g=[Wt,Kt],p=[];function $(d,C){return d[0]?0:1}return l=$(e),f=p[l]=g[l](e),{c(){t=v("meta"),n=M(),pt(o.$$.fragment),s=M(),i=v("main"),a&&a.c(),r=M(),f.c(),c=bt(),_(t,"name","viewport"),_(t,"content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},m(d,C){u(document.head,t),k(d,n,C),Pe(o,d,C),k(d,s,C),k(d,i,C),a&&a.m(i,null),k(d,r,C),p[l].m(d,C),k(d,c,C),b=!0},p(d,[C]){let N=l;l=$(d),l!==N&&(Ot(),fe(p[N],1,1,()=>{p[N]=null}),Pt(),f=p[l],f||(f=p[l]=g[l](d),f.c()),Q(f,1),f.m(c.parentNode,c))},i(d){b||(Q(o.$$.fragment,d),Q(f),b=!0)},o(d){fe(o.$$.fragment,d),fe(f),b=!1},d(d){d&&(P(n),P(s),P(i),P(r),P(c)),P(t),je(o,d),a&&a.d(),p[l].d(d)}}}function Yt(e,t,n){let o;Oe(e,ut,i=>n(0,o=i));const s=typeof BarcodeDetector<"u";return ut.ask(),[o,s]}class Gt extends Ie{constructor(t){super(),ke(this,t,Yt,Xt,de,{})}}new Gt({target:document.getElementById("app")});
